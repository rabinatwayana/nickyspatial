
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="An open-source object-based image analysis library for remote sensing">
      
      
      
        <link rel="canonical" href="https://kshitijrajsharma.github.io/nickyspatial/reference/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../dev/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Package Reference - NickySpatial</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="black">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="NickySpatial" class="md-header__button md-logo" aria-label="NickySpatial" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NickySpatial
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Package Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="None" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="black"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/kshitijrajsharma/nickyspatial" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    kshitijrajsharma/nickyspatial
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  Package Reference

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../dev/" class="md-tabs__link">
          
  
  
  Contribute

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../examples/simple_usecase/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="NickySpatial" class="md-nav__button md-logo" aria-label="NickySpatial" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    NickySpatial
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kshitijrajsharma/nickyspatial" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    kshitijrajsharma/nickyspatial
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Package Reference
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Package Reference
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nickyspatial" class="md-nav__link">
    <span class="md-ellipsis">
      nickyspatial
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial--nickyspatial-an-open-source-object-based-image-analysis-library-for-remote-sensing" class="md-nav__link">
    <span class="md-ellipsis">
      NickySpatial: An open-source object-based image analysis library for remote sensing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatialcore" class="md-nav__link">
    <span class="md-ellipsis">
      nickyspatial.core
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.core" class="md-nav__link">
    <span class="md-ellipsis">
      core
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.core.classifier" class="md-nav__link">
    <span class="md-ellipsis">
      classifier
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.core.classifier.SupervisedClassifier" class="md-nav__link">
    <span class="md-ellipsis">
      SupervisedClassifier
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SupervisedClassifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.classifier.SupervisedClassifier.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.classifier.SupervisedClassifier.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.classifier.SupervisedClassifier.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
    <nav class="md-nav" aria-label="execute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.classifier.SupervisedClassifier.execute--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.classifier.SupervisedClassifier.execute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.core.layer" class="md-nav__link">
    <span class="md-ellipsis">
      layer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.Layer" class="md-nav__link">
    <span class="md-ellipsis">
      Layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.Layer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.Layer.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.Layer.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.Layer.attach_function" class="md-nav__link">
    <span class="md-ellipsis">
      attach_function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.Layer.attach_function--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.Layer.attach_function--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.Layer.copy" class="md-nav__link">
    <span class="md-ellipsis">
      copy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="copy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.Layer.copy--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.Layer.get_function_result" class="md-nav__link">
    <span class="md-ellipsis">
      get_function_result
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_function_result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.Layer.get_function_result--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.Layer.get_function_result--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.LayerManager" class="md-nav__link">
    <span class="md-ellipsis">
      LayerManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LayerManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.LayerManager.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.LayerManager.add_layer" class="md-nav__link">
    <span class="md-ellipsis">
      add_layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.LayerManager.add_layer--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.LayerManager.add_layer--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.LayerManager.get_layer" class="md-nav__link">
    <span class="md-ellipsis">
      get_layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.LayerManager.get_layer--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.LayerManager.get_layer--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.LayerManager.get_layer_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_layer_names
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_layer_names">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.LayerManager.get_layer_names--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.LayerManager.remove_layer" class="md-nav__link">
    <span class="md-ellipsis">
      remove_layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="remove_layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.layer.LayerManager.remove_layer--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.core.rules" class="md-nav__link">
    <span class="md-ellipsis">
      rules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.CommonBase" class="md-nav__link">
    <span class="md-ellipsis">
      CommonBase
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.EnclosedByRuleSet" class="md-nav__link">
    <span class="md-ellipsis">
      EnclosedByRuleSet
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EnclosedByRuleSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.EnclosedByRuleSet.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.EnclosedByRuleSet.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.EnclosedByRuleSet.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
    <nav class="md-nav" aria-label="execute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.EnclosedByRuleSet.execute--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.EnclosedByRuleSet.execute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.MergeRuleSet" class="md-nav__link">
    <span class="md-ellipsis">
      MergeRuleSet
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MergeRuleSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.MergeRuleSet.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.MergeRuleSet.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.MergeRuleSet.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
    <nav class="md-nav" aria-label="execute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.MergeRuleSet.execute--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.MergeRuleSet.execute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.Rule" class="md-nav__link">
    <span class="md-ellipsis">
      Rule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.Rule.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.Rule.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.Rule.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.RuleSet" class="md-nav__link">
    <span class="md-ellipsis">
      RuleSet
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RuleSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.RuleSet.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.RuleSet.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.RuleSet.add_rule" class="md-nav__link">
    <span class="md-ellipsis">
      add_rule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_rule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.RuleSet.add_rule--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.RuleSet.add_rule--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.RuleSet.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
    <nav class="md-nav" aria-label="execute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.RuleSet.execute--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.RuleSet.execute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.RuleSet.get_rules" class="md-nav__link">
    <span class="md-ellipsis">
      get_rules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.RuleSet.get_rules--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.RuleSet.wrap_condition_parts_simple" class="md-nav__link">
    <span class="md-ellipsis">
      wrap_condition_parts_simple
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.TouchedByRuleSet" class="md-nav__link">
    <span class="md-ellipsis">
      TouchedByRuleSet
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TouchedByRuleSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.TouchedByRuleSet.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.TouchedByRuleSet.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.rules.TouchedByRuleSet.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.core.segmentation" class="md-nav__link">
    <span class="md-ellipsis">
      segmentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.core.segmentation.SlicSegmentation" class="md-nav__link">
    <span class="md-ellipsis">
      SlicSegmentation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SlicSegmentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.segmentation.SlicSegmentation.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.segmentation.SlicSegmentation.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.segmentation.SlicSegmentation.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
    <nav class="md-nav" aria-label="execute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.segmentation.SlicSegmentation.execute--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.core.segmentation.SlicSegmentation.execute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatialfilters" class="md-nav__link">
    <span class="md-ellipsis">
      nickyspatial.filters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.filters" class="md-nav__link">
    <span class="md-ellipsis">
      filters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.filters.spatial" class="md-nav__link">
    <span class="md-ellipsis">
      spatial
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.filters.spatial.merge_small_segments" class="md-nav__link">
    <span class="md-ellipsis">
      merge_small_segments
    </span>
  </a>
  
    <nav class="md-nav" aria-label="merge_small_segments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.filters.spatial.merge_small_segments--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.filters.spatial.merge_small_segments--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.filters.spatial.select_by_area" class="md-nav__link">
    <span class="md-ellipsis">
      select_by_area
    </span>
  </a>
  
    <nav class="md-nav" aria-label="select_by_area">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.filters.spatial.select_by_area--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.filters.spatial.select_by_area--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.filters.spatial.smooth_boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      smooth_boundaries
    </span>
  </a>
  
    <nav class="md-nav" aria-label="smooth_boundaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.filters.spatial.smooth_boundaries--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.filters.spatial.smooth_boundaries--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.filters.spectral" class="md-nav__link">
    <span class="md-ellipsis">
      spectral
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.filters.spectral.enhance_contrast" class="md-nav__link">
    <span class="md-ellipsis">
      enhance_contrast
    </span>
  </a>
  
    <nav class="md-nav" aria-label="enhance_contrast">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.filters.spectral.enhance_contrast--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.filters.spectral.enhance_contrast--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.filters.spectral.spectral_filter" class="md-nav__link">
    <span class="md-ellipsis">
      spectral_filter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="spectral_filter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.filters.spectral.spectral_filter--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.filters.spectral.spectral_filter--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatialio" class="md-nav__link">
    <span class="md-ellipsis">
      nickyspatial.io
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.io" class="md-nav__link">
    <span class="md-ellipsis">
      io
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.io.raster" class="md-nav__link">
    <span class="md-ellipsis">
      raster
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.io.raster.layer_to_raster" class="md-nav__link">
    <span class="md-ellipsis">
      layer_to_raster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="layer_to_raster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.io.raster.layer_to_raster--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.io.raster.read_raster" class="md-nav__link">
    <span class="md-ellipsis">
      read_raster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="read_raster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.io.raster.read_raster--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.io.raster.read_raster--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.io.raster.write_raster" class="md-nav__link">
    <span class="md-ellipsis">
      write_raster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="write_raster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.io.raster.write_raster--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.io.vector" class="md-nav__link">
    <span class="md-ellipsis">
      vector
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.io.vector.layer_to_vector" class="md-nav__link">
    <span class="md-ellipsis">
      layer_to_vector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="layer_to_vector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.io.vector.layer_to_vector--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.io.vector.read_vector" class="md-nav__link">
    <span class="md-ellipsis">
      read_vector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="read_vector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.io.vector.read_vector--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.io.vector.read_vector--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.io.vector.write_vector" class="md-nav__link">
    <span class="md-ellipsis">
      write_vector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="write_vector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.io.vector.write_vector--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatialstats" class="md-nav__link">
    <span class="md-ellipsis">
      nickyspatial.stats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.stats" class="md-nav__link">
    <span class="md-ellipsis">
      stats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.stats.basic" class="md-nav__link">
    <span class="md-ellipsis">
      basic
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.stats.basic.attach_basic_stats" class="md-nav__link">
    <span class="md-ellipsis">
      attach_basic_stats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_basic_stats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.basic.attach_basic_stats--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.basic.attach_basic_stats--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.stats.basic.attach_class_distribution" class="md-nav__link">
    <span class="md-ellipsis">
      attach_class_distribution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_class_distribution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.basic.attach_class_distribution--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.basic.attach_class_distribution--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.stats.basic.attach_count" class="md-nav__link">
    <span class="md-ellipsis">
      attach_count
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_count">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.basic.attach_count--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.basic.attach_count--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.stats.spatial" class="md-nav__link">
    <span class="md-ellipsis">
      spatial
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.stats.spatial.attach_area_stats" class="md-nav__link">
    <span class="md-ellipsis">
      attach_area_stats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_area_stats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.spatial.attach_area_stats--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.spatial.attach_area_stats--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.stats.spatial.attach_neighbor_stats" class="md-nav__link">
    <span class="md-ellipsis">
      attach_neighbor_stats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_neighbor_stats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.spatial.attach_neighbor_stats--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.spatial.attach_neighbor_stats--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.stats.spatial.attach_shape_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      attach_shape_metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_shape_metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.spatial.attach_shape_metrics--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.spatial.attach_shape_metrics--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.stats.spectral" class="md-nav__link">
    <span class="md-ellipsis">
      spectral
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.stats.spectral.attach_ndvi" class="md-nav__link">
    <span class="md-ellipsis">
      attach_ndvi
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_ndvi">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.spectral.attach_ndvi--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.spectral.attach_ndvi--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.stats.spectral.attach_spectral_indices" class="md-nav__link">
    <span class="md-ellipsis">
      attach_spectral_indices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_spectral_indices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.spectral.attach_spectral_indices--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.stats.spectral.attach_spectral_indices--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatialutils" class="md-nav__link">
    <span class="md-ellipsis">
      nickyspatial.utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.utils.helpers" class="md-nav__link">
    <span class="md-ellipsis">
      helpers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.utils.helpers.calculate_statistics_summary" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_statistics_summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculate_statistics_summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.utils.helpers.calculate_statistics_summary--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.utils.helpers.calculate_statistics_summary--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.utils.helpers.create_sample_data" class="md-nav__link">
    <span class="md-ellipsis">
      create_sample_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="create_sample_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.utils.helpers.create_sample_data--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.utils.helpers.get_band_statistics" class="md-nav__link">
    <span class="md-ellipsis">
      get_band_statistics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_band_statistics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.utils.helpers.get_band_statistics--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.utils.helpers.get_band_statistics--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.utils.helpers.memory_usage" class="md-nav__link">
    <span class="md-ellipsis">
      memory_usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="memory_usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.utils.helpers.memory_usage--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.utils.helpers.memory_usage--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatialviz" class="md-nav__link">
    <span class="md-ellipsis">
      nickyspatial.viz
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.viz" class="md-nav__link">
    <span class="md-ellipsis">
      viz
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.viz.charts" class="md-nav__link">
    <span class="md-ellipsis">
      charts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.viz.charts.plot_histogram" class="md-nav__link">
    <span class="md-ellipsis">
      plot_histogram
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plot_histogram">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.viz.charts.plot_histogram--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.viz.charts.plot_histogram--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.viz.charts.plot_scatter" class="md-nav__link">
    <span class="md-ellipsis">
      plot_scatter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plot_scatter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.viz.charts.plot_scatter--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.viz.charts.plot_scatter--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.viz.charts.plot_statistics" class="md-nav__link">
    <span class="md-ellipsis">
      plot_statistics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plot_statistics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.viz.charts.plot_statistics--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.viz.charts.plot_statistics--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.viz.maps" class="md-nav__link">
    <span class="md-ellipsis">
      maps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.viz.maps.plot_classification" class="md-nav__link">
    <span class="md-ellipsis">
      plot_classification
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.viz.maps.plot_comparison" class="md-nav__link">
    <span class="md-ellipsis">
      plot_comparison
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.viz.maps.plot_layer" class="md-nav__link">
    <span class="md-ellipsis">
      plot_layer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.viz.maps.plot_layer_interactive" class="md-nav__link">
    <span class="md-ellipsis">
      plot_layer_interactive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.viz.maps.plot_layer_interactive_plotly" class="md-nav__link">
    <span class="md-ellipsis">
      plot_layer_interactive_plotly
    </span>
  </a>
  
    <nav class="md-nav" aria-label="plot_layer_interactive_plotly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nickyspatial.viz.maps.plot_layer_interactive_plotly--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.viz.maps.plot_layer_interactive_plotly--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nickyspatial.viz.maps.plot_layer_interactive_plotly--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nickyspatial.viz.maps.plot_sample" class="md-nav__link">
    <span class="md-ellipsis">
      plot_sample
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Contribute
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Contribute
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dev/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/simple_usecase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    nickyspatial Workflow Example
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/supervised_classification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Supervised classification Workflow Example
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="nickyspatial"></a>
    <div class="doc doc-contents first">

        <h2 id="nickyspatial--nickyspatial-an-open-source-object-based-image-analysis-library-for-remote-sensing">NickySpatial: An open-source object-based image analysis library for remote sensing<a class="headerlink" href="#nickyspatial--nickyspatial-an-open-source-object-based-image-analysis-library-for-remote-sensing" title="Permanent link">&para;</a></h2>
<p>NickySpatial is a Python package for object-based image analysis,
providing functionality similar to commercial software like eCognition.</p>
<p>Key features:
- Multiresolution segmentation
- Object-based analysis
- Rule-based classification
- Statistics calculation
- Integration with geospatial data formats</p>









  <div class="doc doc-children">











  </div>

    </div>

</div><h2 id="nickyspatialcore"><code>nickyspatial.core</code><a class="headerlink" href="#nickyspatialcore" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<a id="nickyspatial.core"></a>
    <div class="doc doc-contents first">

        <p>The core package encompasses fundamental data structures and algorithms for nickyspatial.</p>
<p>It helps define the building blocks like layers, segmentation methods, and rule-based logic for object analysis workflows.</p>









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="nickyspatial.core.classifier"></a>
    <div class="doc doc-contents first">

        <p>Implements supervised classification algorithms to classify the segments.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="nickyspatial.core.classifier.SupervisedClassifier" class="doc doc-heading">
            <code>SupervisedClassifier</code>


<a href="#nickyspatial.core.classifier.SupervisedClassifier" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Implementation of Supervised Classification algorithm.</p>







              <details class="quote">
                <summary>Source code in <code>nickyspatial/core/classifier.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-0-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-0-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-0-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">SupervisedClassifier</span><span class="p">:</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Implementation of Supervised Classification algorithm.&quot;&quot;&quot;</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="c1"># TODO: name vs layer_name</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">classifier_type</span><span class="o">=</span><span class="s2">&quot;Random Forest&quot;</span><span class="p">,</span> <span class="n">classifier_params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the segmentation algorithm.</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">        scale : str</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">            classifier type name eg: RF for Random Forest, SVC for Support Vector Classifier</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">        classifier_params : dict</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">           additional parameters relayed to classifier</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_type</span> <span class="o">=</span> <span class="n">classifier_type</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_params</span> <span class="o">=</span> <span class="n">classifier_params</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">training_layer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="s2">&quot;Supervised_Classification&quot;</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_training_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">samples</span><span class="p">):</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create vector objects from segments.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        samples : dict</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">            key: class_name</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">            values: list of segment_ids</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">            eg: {&quot;cropland&quot;:[1,2,3],&quot;built-up&quot;:[4,5,6]}</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        --------</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        segment_objects : geopandas.GeoDataFrame</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">            GeoDataFrame with segment polygons</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;classification&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="k">for</span> <span class="n">class_name</span> <span class="ow">in</span> <span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>            <span class="n">layer</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">class_name</span><span class="p">]),</span> <span class="s2">&quot;classification&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">class_name</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="n">layer</span> <span class="o">=</span> <span class="n">layer</span><span class="p">[</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;classification&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">training_layer</span> <span class="o">=</span> <span class="n">layer</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="k">return</span> <span class="n">layer</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate statistics for segments based on image data.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        layer : Layer</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">            Layer containing segments</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        image_data : numpy.ndarray</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            Array with raster data values (bands, height, width)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        bands : list of str</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">            Names of the bands</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_layer</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">,</span> <span class="s2">&quot;classification&quot;</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_layer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">]</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_layer</span><span class="p">[</span><span class="s2">&quot;classification&quot;</span><span class="p">]</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_type</span> <span class="o">==</span> <span class="s2">&quot;Random Forest&quot;</span><span class="p">:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_params</span><span class="p">)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="n">feature_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="n">feature_importances</span> <span class="o">=</span> <span class="n">feature_importances</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="n">test_accuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">oob_score_</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="c1"># print(&quot;OOB Score:&quot;, self.classifier.oob_score_)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="p">,</span> <span class="n">test_accuracy</span><span class="p">,</span> <span class="n">feature_importances</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">):</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform classification prediction on input layer features.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        layer : geopandas.GeoDataFrame</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">            Input data containing at least a &#39;segment_id&#39; and &#39;geometry&#39; column, along with</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">            feature columns required by the classifier. If a &#39;classification&#39; column does not</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">            exist, it will be created.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        -------</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        The input layer with an updated &#39;classification&#39; column containing predicted labels.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;classification&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="c1"># if not features:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="c1">#     x = layer.drop(columns=[&quot;segment_id&quot;, &quot;classification&quot;, &quot;geometry&quot;], errors=&quot;ignore&quot;)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="c1"># else:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">]</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="c1"># print(layer.columns)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="c1"># x = layer.drop(columns=[&quot;segment_id&quot;, &quot;classification&quot;, &quot;geometry&quot;], errors=&quot;ignore&quot;)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">layer</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;classification&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;classification&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictions</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="k">return</span> <span class="n">layer</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_layer</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the supervised classification workflow on the source layer.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        This method creates a new layer by copying the input source layer, training a classifier</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        using provided samples, predicting classifications, and storing the results in a new layer.</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        Optionally, the resulting layer can be added to a layer manager.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        source_layer : Layer</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">            The input layer containing spatial objects and metadata (transform, CRS, raster).</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        samples : dict</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">            A dictionary of training samples where keys are class labels and values are lists</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">            of segment IDs or features used for training. Default is an empty dictionary.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        layer_manager : LayerManager, optional</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">            An optional layer manager object used to manage and store the resulting layer.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        layer_name : str, optional</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">            The name to assign to the resulting classified layer.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        -------</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        Layer</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">            A new Layer object containing the predicted classifications, copied metadata from</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">            the source layer, and updated attributes.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">result_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source_layer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;merged&quot;</span><span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="n">layer</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_training_sample</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">samples</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">feature_importances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">layer</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="s2">&quot;supervised classification&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="p">}</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="k">return</span> <span class="n">result_layer</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">feature_importances</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.classifier.SupervisedClassifier.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">classifier_type</span><span class="o">=</span><span class="s1">&#39;Random Forest&#39;</span><span class="p">,</span> <span class="n">classifier_params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.core.classifier.SupervisedClassifier.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize the segmentation algorithm.</p>
<h5 id="nickyspatial.core.classifier.SupervisedClassifier.__init__--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.classifier.SupervisedClassifier.__init__--parameters" title="Permanent link">&para;</a></h5>
<p>scale : str
    classifier type name eg: RF for Random Forest, SVC for Support Vector Classifier
classifier_params : dict
   additional parameters relayed to classifier</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/classifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">classifier_type</span><span class="o">=</span><span class="s2">&quot;Random Forest&quot;</span><span class="p">,</span> <span class="n">classifier_params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the segmentation algorithm.</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    scale : str</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">        classifier type name eg: RF for Random Forest, SVC for Support Vector Classifier</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    classifier_params : dict</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">       additional parameters relayed to classifier</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">classifier_type</span> <span class="o">=</span> <span class="n">classifier_type</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">classifier_params</span> <span class="o">=</span> <span class="n">classifier_params</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">training_layer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="s2">&quot;Supervised_Classification&quot;</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.classifier.SupervisedClassifier.execute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.core.classifier.SupervisedClassifier.execute" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Execute the supervised classification workflow on the source layer.</p>
<p>This method creates a new layer by copying the input source layer, training a classifier
using provided samples, predicting classifications, and storing the results in a new layer.
Optionally, the resulting layer can be added to a layer manager.</p>
<h5 id="nickyspatial.core.classifier.SupervisedClassifier.execute--parameters">Parameters<a class="headerlink" href="#nickyspatial.core.classifier.SupervisedClassifier.execute--parameters" title="Permanent link">&para;</a></h5>
<p>source_layer : Layer
    The input layer containing spatial objects and metadata (transform, CRS, raster).
samples : dict
    A dictionary of training samples where keys are class labels and values are lists
    of segment IDs or features used for training. Default is an empty dictionary.
layer_manager : LayerManager, optional
    An optional layer manager object used to manage and store the resulting layer.
layer_name : str, optional
    The name to assign to the resulting classified layer.</p>
<h5 id="nickyspatial.core.classifier.SupervisedClassifier.execute--returns">Returns:<a class="headerlink" href="#nickyspatial.core.classifier.SupervisedClassifier.execute--returns" title="Permanent link">&para;</a></h5>
<p>Layer
    A new Layer object containing the predicted classifications, copied metadata from
    the source layer, and updated attributes.</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/classifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_layer</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute the supervised classification workflow on the source layer.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    This method creates a new layer by copying the input source layer, training a classifier</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    using provided samples, predicting classifications, and storing the results in a new layer.</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    Optionally, the resulting layer can be added to a layer manager.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    source_layer : Layer</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        The input layer containing spatial objects and metadata (transform, CRS, raster).</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    samples : dict</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        A dictionary of training samples where keys are class labels and values are lists</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        of segment IDs or features used for training. Default is an empty dictionary.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    layer_manager : LayerManager, optional</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        An optional layer manager object used to manage and store the resulting layer.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    layer_name : str, optional</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        The name to assign to the resulting classified layer.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    -------</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    Layer</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        A new Layer object containing the predicted classifications, copied metadata from</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        the source layer, and updated attributes.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="n">result_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source_layer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;merged&quot;</span><span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="n">layer</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_training_sample</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">samples</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="n">_</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">feature_importances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">layer</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="s2">&quot;supervised classification&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="p">}</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="k">return</span> <span class="n">result_layer</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">feature_importances</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="nickyspatial.core.layer"></a>
    <div class="doc doc-contents first">

        <p>Defines the Layer class and related functionality for organizing geospatial data.</p>
<p>A layer can represent a conceptual container for a vector object which is tightly coupled with underlying raster data, allowing
additional metadata or processing logic to be attached making sure heirarchical relationships are maintained.
This module provides the Layer and LayerManager classes, which manage layers of geospatial data, including segmentation results,
classifications,and filters. Layers can be created, copied, and manipulated, and they support attaching functions to calculate
additional properties.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="nickyspatial.core.layer.Layer" class="doc doc-heading">
            <code>Layer</code>


<a href="#nickyspatial.core.layer.Layer" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>A Layer represents a set of objects (segments or classification results) with associated properties.</p>
<p>Layers can be derived from segmentation, rule application, or filters.
Each layer can have functions attached to calculate additional properties.</p>







              <details class="quote">
                <summary>Source code in <code>nickyspatial/core/layer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="k">class</span><span class="w"> </span><span class="nc">Layer</span><span class="p">:</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A Layer represents a set of objects (segments or classification results) with associated properties.</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    Layers can be derived from segmentation, rule application, or filters.</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    Each layer can have functions attached to calculate additional properties.</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;generic&quot;</span><span class="p">):</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a Layer.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        name : str, optional</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">            Name of the layer. If None, a unique name will be generated.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        parent : Layer, optional</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">            Parent layer that this layer is derived from.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        type : str</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">            Type of layer: &quot;segmentation&quot;, &quot;classification&quot;, &quot;filter&quot;, or &quot;generic&quot;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;Layer_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">attached_functions</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">attach_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Attach a function to this layer and execute it.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        function : callable</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            Function to attach and execute</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        name : str, optional</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            Name for this function. If None, uses function.__name__</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        **kwargs : dict</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            Arguments to pass to the function</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        --------</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        self : Layer</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            Returns self for chaining</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="n">func_name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">function</span><span class="o">.</span><span class="vm">__name__</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">attached_functions</span><span class="p">[</span><span class="n">func_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>            <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="n">function</span><span class="p">,</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>            <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="p">}</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_function_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">):</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the result of an attached function.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        function_name : str</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            Name of the attached function</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        --------</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        result : any</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            Result of the function</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="k">if</span> <span class="n">function_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attached_functions</span><span class="p">:</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function &#39;</span><span class="si">{</span><span class="n">function_name</span><span class="si">}</span><span class="s2">&#39; not attached to this layer&quot;</span><span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attached_functions</span><span class="p">[</span><span class="n">function_name</span><span class="p">][</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a copy of this layer.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        --------</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        layer_copy : Layer</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">            Copy of this layer</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="n">new_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_copy&quot;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="n">new_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="n">new_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">new_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">new_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">new_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="k">return</span> <span class="n">new_layer</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;String representation of the layer.&quot;&quot;&quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="n">num_objects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="n">num_objects</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">parent_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Layer &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; (type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">, parent: </span><span class="si">{</span><span class="n">parent_name</span><span class="si">}</span><span class="s2">, objects: </span><span class="si">{</span><span class="n">num_objects</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.layer.Layer.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;generic&#39;</span><span class="p">)</span></code>

<a href="#nickyspatial.core.layer.Layer.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize a Layer.</p>
<h5 id="nickyspatial.core.layer.Layer.__init__--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.layer.Layer.__init__--parameters" title="Permanent link">&para;</a></h5>
<p>name : str, optional
    Name of the layer. If None, a unique name will be generated.
parent : Layer, optional
    Parent layer that this layer is derived from.
type : str
    Type of layer: "segmentation", "classification", "filter", or "generic"</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/layer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;generic&quot;</span><span class="p">):</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize a Layer.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    name : str, optional</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        Name of the layer. If None, a unique name will be generated.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    parent : Layer, optional</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        Parent layer that this layer is derived from.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    type : str</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        Type of layer: &quot;segmentation&quot;, &quot;classification&quot;, &quot;filter&quot;, or &quot;generic&quot;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;Layer_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">attached_functions</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.layer.Layer.__str__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__str__</span><span class="p">()</span></code>

<a href="#nickyspatial.core.layer.Layer.__str__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>String representation of the layer.</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/layer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;String representation of the layer.&quot;&quot;&quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">num_objects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="n">num_objects</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="n">parent_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Layer &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; (type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">, parent: </span><span class="si">{</span><span class="n">parent_name</span><span class="si">}</span><span class="s2">, objects: </span><span class="si">{</span><span class="n">num_objects</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.layer.Layer.attach_function" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attach_function</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#nickyspatial.core.layer.Layer.attach_function" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Attach a function to this layer and execute it.</p>
<h5 id="nickyspatial.core.layer.Layer.attach_function--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.layer.Layer.attach_function--parameters" title="Permanent link">&para;</a></h5>
<p>function : callable
    Function to attach and execute
name : str, optional
    Name for this function. If None, uses function.<strong>name</strong>
**kwargs : dict
    Arguments to pass to the function</p>
<h5 id="nickyspatial.core.layer.Layer.attach_function--returns">Returns:<a class="headerlink" href="#nickyspatial.core.layer.Layer.attach_function--returns" title="Permanent link">&para;</a></h5>
<p>self : Layer
    Returns self for chaining</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/layer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="k">def</span><span class="w"> </span><span class="nf">attach_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Attach a function to this layer and execute it.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    function : callable</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        Function to attach and execute</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    name : str, optional</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        Name for this function. If None, uses function.__name__</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    **kwargs : dict</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        Arguments to pass to the function</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    --------</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    self : Layer</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        Returns self for chaining</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">func_name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="n">function</span><span class="o">.</span><span class="vm">__name__</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">attached_functions</span><span class="p">[</span><span class="n">func_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="n">function</span><span class="p">,</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="p">}</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.layer.Layer.copy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">copy</span><span class="p">()</span></code>

<a href="#nickyspatial.core.layer.Layer.copy" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a copy of this layer.</p>
<h5 id="nickyspatial.core.layer.Layer.copy--returns">Returns:<a class="headerlink" href="#nickyspatial.core.layer.Layer.copy--returns" title="Permanent link">&para;</a></h5>
<p>layer_copy : Layer
    Copy of this layer</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/layer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a copy of this layer.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">    --------</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    layer_copy : Layer</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        Copy of this layer</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="n">new_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_copy&quot;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="n">new_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="n">new_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">new_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">new_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="n">new_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="k">return</span> <span class="n">new_layer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.layer.Layer.get_function_result" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_function_result</span><span class="p">(</span><span class="n">function_name</span><span class="p">)</span></code>

<a href="#nickyspatial.core.layer.Layer.get_function_result" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the result of an attached function.</p>
<h5 id="nickyspatial.core.layer.Layer.get_function_result--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.layer.Layer.get_function_result--parameters" title="Permanent link">&para;</a></h5>
<p>function_name : str
    Name of the attached function</p>
<h5 id="nickyspatial.core.layer.Layer.get_function_result--returns">Returns:<a class="headerlink" href="#nickyspatial.core.layer.Layer.get_function_result--returns" title="Permanent link">&para;</a></h5>
<p>result : any
    Result of the function</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/layer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_function_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">):</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the result of an attached function.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    function_name : str</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        Name of the attached function</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    --------</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    result : any</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        Result of the function</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="k">if</span> <span class="n">function_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attached_functions</span><span class="p">:</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function &#39;</span><span class="si">{</span><span class="n">function_name</span><span class="si">}</span><span class="s2">&#39; not attached to this layer&quot;</span><span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attached_functions</span><span class="p">[</span><span class="n">function_name</span><span class="p">][</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="nickyspatial.core.layer.LayerManager" class="doc doc-heading">
            <code>LayerManager</code>


<a href="#nickyspatial.core.layer.LayerManager" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Manages a collection of layers and their relationships.</p>







              <details class="quote">
                <summary>Source code in <code>nickyspatial/core/layer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="k">class</span><span class="w"> </span><span class="nc">LayerManager</span><span class="p">:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages a collection of layers and their relationships.&quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the layer manager.&quot;&quot;&quot;</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_layer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">set_active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a layer to the manager.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        layer : Layer</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">            Layer to add</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        set_active : bool</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">            Whether to set this layer as the active layer</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">        --------</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">        layer : Layer</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">            The added layer</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="k">if</span> <span class="n">set_active</span><span class="p">:</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">active_layer</span> <span class="o">=</span> <span class="n">layer</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="k">return</span> <span class="n">layer</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id_or_name</span><span class="p">):</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a layer by ID or name.</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        layer_id_or_name : str</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">            Layer ID or name</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">        --------</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        layer : Layer</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">            The requested layer</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="k">if</span> <span class="n">layer_id_or_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">layer_id_or_name</span><span class="p">]</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">layer_id_or_name</span><span class="p">:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>                <span class="k">return</span> <span class="n">layer</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Layer &#39;</span><span class="si">{</span><span class="n">layer_id_or_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_layer_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of all layer names.</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        --------</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">        names : list</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">            List of layer names</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="k">return</span> <span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id_or_name</span><span class="p">):</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a layer from the manager.</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        layer_id_or_name : str</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">            Layer ID or name</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="n">layer_id_or_name</span><span class="p">)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_layer</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_layer</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">layer</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">active_layer</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">active_layer</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.layer.LayerManager.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

<a href="#nickyspatial.core.layer.LayerManager.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize the layer manager.</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/layer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the layer manager.&quot;&quot;&quot;</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">active_layer</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.layer.LayerManager.add_layer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">set_active</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#nickyspatial.core.layer.LayerManager.add_layer" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add a layer to the manager.</p>
<h5 id="nickyspatial.core.layer.LayerManager.add_layer--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.layer.LayerManager.add_layer--parameters" title="Permanent link">&para;</a></h5>
<p>layer : Layer
    Layer to add
set_active : bool
    Whether to set this layer as the active layer</p>
<h5 id="nickyspatial.core.layer.LayerManager.add_layer--returns">Returns:<a class="headerlink" href="#nickyspatial.core.layer.LayerManager.add_layer--returns" title="Permanent link">&para;</a></h5>
<p>layer : Layer
    The added layer</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/layer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">set_active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a layer to the manager.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        Layer to add</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    set_active : bool</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        Whether to set this layer as the active layer</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    --------</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">        The added layer</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="k">if</span> <span class="n">set_active</span><span class="p">:</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_layer</span> <span class="o">=</span> <span class="n">layer</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="k">return</span> <span class="n">layer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.layer.LayerManager.get_layer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_layer</span><span class="p">(</span><span class="n">layer_id_or_name</span><span class="p">)</span></code>

<a href="#nickyspatial.core.layer.LayerManager.get_layer" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get a layer by ID or name.</p>
<h5 id="nickyspatial.core.layer.LayerManager.get_layer--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.layer.LayerManager.get_layer--parameters" title="Permanent link">&para;</a></h5>
<p>layer_id_or_name : str
    Layer ID or name</p>
<h5 id="nickyspatial.core.layer.LayerManager.get_layer--returns">Returns:<a class="headerlink" href="#nickyspatial.core.layer.LayerManager.get_layer--returns" title="Permanent link">&para;</a></h5>
<p>layer : Layer
    The requested layer</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/layer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id_or_name</span><span class="p">):</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a layer by ID or name.</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">    layer_id_or_name : str</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        Layer ID or name</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    --------</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        The requested layer</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="k">if</span> <span class="n">layer_id_or_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">layer_id_or_name</span><span class="p">]</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">layer_id_or_name</span><span class="p">:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="k">return</span> <span class="n">layer</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Layer &#39;</span><span class="si">{</span><span class="n">layer_id_or_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.layer.LayerManager.get_layer_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_layer_names</span><span class="p">()</span></code>

<a href="#nickyspatial.core.layer.LayerManager.get_layer_names" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get a list of all layer names.</p>
<h5 id="nickyspatial.core.layer.LayerManager.get_layer_names--returns">Returns:<a class="headerlink" href="#nickyspatial.core.layer.LayerManager.get_layer_names--returns" title="Permanent link">&para;</a></h5>
<p>names : list
    List of layer names</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/layer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_layer_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a list of all layer names.</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    --------</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">    names : list</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">        List of layer names</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.layer.LayerManager.remove_layer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_layer</span><span class="p">(</span><span class="n">layer_id_or_name</span><span class="p">)</span></code>

<a href="#nickyspatial.core.layer.LayerManager.remove_layer" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Remove a layer from the manager.</p>
<h5 id="nickyspatial.core.layer.LayerManager.remove_layer--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.layer.LayerManager.remove_layer--parameters" title="Permanent link">&para;</a></h5>
<p>layer_id_or_name : str
    Layer ID or name</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/layer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="k">def</span><span class="w"> </span><span class="nf">remove_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_id_or_name</span><span class="p">):</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a layer from the manager.</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">    layer_id_or_name : str</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        Layer ID or name</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="n">layer_id_or_name</span><span class="p">)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_layer</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_layer</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">layer</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">active_layer</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">active_layer</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="nickyspatial.core.rules"></a>
    <div class="doc doc-contents first">

        <p>Provides a rule engine for object-based analysis, where segments or layers are processed according to custom logic.</p>
<p>Main idea here is to allow encode expert rules that can be applied to object segments which are layers in a nickyspatial context.
So rules are tied up to the layers , they can be attached or revoked or executed multiple items</p>
<p>Developers can define domain-specific rules to classify or merge features based on attributes.
This module includes the Rule and RuleSet classes, which allow users to create, manage, and apply rules to layers.
The RuleSet class can be used to group multiple rules together, and the execute method applies these rules to a given layer.
The rules can be defined using string expressions that can be evaluated using the numexpr library for performance.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="nickyspatial.core.rules.CommonBase" class="doc doc-heading">
            <code>CommonBase</code>


<a href="#nickyspatial.core.rules.CommonBase" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>A shared utility base class for spatial rule sets.</p>
<p>This class provides common methods used by multiple rule sets
to preprocess layer data and determine spatial relationships
between segments.</p>







              <details class="quote">
                <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="k">class</span><span class="w"> </span><span class="nc">CommonBase</span><span class="p">:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A shared utility base class for spatial rule sets.</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">    This class provides common methods used by multiple rule sets</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    to preprocess layer data and determine spatial relationships</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    between segments.</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_preprocess_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">):</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare geometry and class maps from a spatial layer.</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        layer : Layer</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">            The spatial layer containing objects with segment geometry and class labels.</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">        class_column_name : str</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">            The column name that stores class values (e.g., &quot;veg_class&quot;, &quot;land_use&quot;).</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">        --------</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">        geom_map : dict</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">            A dictionary mapping segment IDs to shapely geometry objects.</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        class_map : dict</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">            A dictionary mapping segment IDs to their respective class values.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="n">geom_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">sid</span><span class="p">:</span> <span class="n">shape</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span> <span class="k">for</span> <span class="n">sid</span><span class="p">,</span> <span class="n">geom</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">],</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)}</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="n">class_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">class_column_name</span><span class="p">],</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="k">return</span> <span class="n">geom_map</span><span class="p">,</span> <span class="n">class_map</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_find_neighbors</span><span class="p">(</span><span class="n">segment_id</span><span class="p">,</span> <span class="n">geom_map</span><span class="p">):</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find neighboring segments based on spatial intersection.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        segment_id : int or str</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">            The ID of the segment whose neighbors are to be found.</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        geom_map : dict</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">            A dictionary mapping segment IDs to shapely geometry objects.</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">        --------</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        neighbors : list</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">            A list of segment IDs that intersect with the given segment.</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="n">segment_geom</span> <span class="o">=</span> <span class="n">geom_map</span><span class="p">[</span><span class="n">segment_id</span><span class="p">]</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="n">neighbors</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="k">for</span> <span class="n">other_id</span><span class="p">,</span> <span class="n">other_geom</span> <span class="ow">in</span> <span class="n">geom_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="k">if</span> <span class="n">other_id</span> <span class="o">!=</span> <span class="n">segment_id</span> <span class="ow">and</span> <span class="n">segment_geom</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">other_geom</span><span class="p">):</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>                <span class="n">neighbors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other_id</span><span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="k">return</span> <span class="n">neighbors</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="nickyspatial.core.rules.EnclosedByRuleSet" class="doc doc-heading">
            <code>EnclosedByRuleSet</code>


<a href="#nickyspatial.core.rules.EnclosedByRuleSet" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CommonBase (nickyspatial.core.rules.CommonBase)" href="#nickyspatial.core.rules.CommonBase">CommonBase</a></code></p>


        <p>A rule set to reclassify segments based on spatial enclosure.</p>
<p>This rule set identifies segments of one class (A) that are entirely surrounded
by segments of another class (B), and reclassifies them into a new class.</p>







              <details class="quote">
                <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="k">class</span><span class="w"> </span><span class="nc">EnclosedByRuleSet</span><span class="p">(</span><span class="n">CommonBase</span><span class="p">):</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A rule set to reclassify segments based on spatial enclosure.</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">    This rule set identifies segments of one class (A) that are entirely surrounded</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">    by segments of another class (B), and reclassifies them into a new class.</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the merge rule set.</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">        name : str, optional</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">            Name of the merge rule set</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="s2">&quot;EnclosedByRuleSet&quot;</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">source_layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">,</span> <span class="n">class_value_a</span><span class="p">,</span> <span class="n">class_value_b</span><span class="p">,</span> <span class="n">new_class_name</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>    <span class="p">):</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply enclosed-by logic to identify and reclassify segments.</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">        source_layer : Layer</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">            The source spatial layer containing segments.</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">        class_column_name : str</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">            The name of the column containing class labels (e.g., &quot;veg_class&quot;).</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">        class_value_a : str</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">            The class value to check for enclosure (target to reclassify).</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">        class_value_b : str</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">            The class value expected to surround class A segments.</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">        new_class_name : str</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">            The new class name to assign to enclosed segments.</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">        layer_manager : LayerManager, optional</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">            Optional manager to register the resulting layer.</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">        layer_name : str, optional</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">            Optional name for the result layer.</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">        --------</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">        result_layer : Layer</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">            A new layer with updated class values for enclosed segments.</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_name</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="n">layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source_layer</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="n">result_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source_layer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;merged&quot;</span><span class="p">)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="n">surrounded_segments</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="n">geom_map</span><span class="p">,</span> <span class="n">class_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_layer</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">)</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>        <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>            <span class="k">if</span> <span class="n">class_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span> <span class="o">!=</span> <span class="n">class_value_a</span><span class="p">:</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                <span class="k">continue</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>            <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_neighbors</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">geom_map</span><span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>            <span class="k">if</span> <span class="n">neighbors</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">class_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n_id</span><span class="p">)</span> <span class="o">==</span> <span class="n">class_value_b</span> <span class="k">for</span> <span class="n">n_id</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">):</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>                <span class="n">surrounded_segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">surrounded_segments</span><span class="p">)),</span> <span class="n">class_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_class_name</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">df</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>            <span class="s2">&quot;enclosed_by_ruleset_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="p">}</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="k">return</span> <span class="n">result_layer</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.rules.EnclosedByRuleSet.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.core.rules.EnclosedByRuleSet.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize the merge rule set.</p>
<h5 id="nickyspatial.core.rules.EnclosedByRuleSet.__init__--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.rules.EnclosedByRuleSet.__init__--parameters" title="Permanent link">&para;</a></h5>
<p>name : str, optional
    Name of the merge rule set</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the merge rule set.</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">    name : str, optional</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">        Name of the merge rule set</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="s2">&quot;EnclosedByRuleSet&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.rules.EnclosedByRuleSet.execute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">,</span> <span class="n">class_value_a</span><span class="p">,</span> <span class="n">class_value_b</span><span class="p">,</span> <span class="n">new_class_name</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.core.rules.EnclosedByRuleSet.execute" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply enclosed-by logic to identify and reclassify segments.</p>
<h5 id="nickyspatial.core.rules.EnclosedByRuleSet.execute--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.rules.EnclosedByRuleSet.execute--parameters" title="Permanent link">&para;</a></h5>
<p>source_layer : Layer
    The source spatial layer containing segments.
class_column_name : str
    The name of the column containing class labels (e.g., "veg_class").
class_value_a : str
    The class value to check for enclosure (target to reclassify).
class_value_b : str
    The class value expected to surround class A segments.
new_class_name : str
    The new class name to assign to enclosed segments.
layer_manager : LayerManager, optional
    Optional manager to register the resulting layer.
layer_name : str, optional
    Optional name for the result layer.</p>
<h5 id="nickyspatial.core.rules.EnclosedByRuleSet.execute--returns">Returns:<a class="headerlink" href="#nickyspatial.core.rules.EnclosedByRuleSet.execute--returns" title="Permanent link">&para;</a></h5>
<p>result_layer : Layer
    A new layer with updated class values for enclosed segments.</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">source_layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">,</span> <span class="n">class_value_a</span><span class="p">,</span> <span class="n">class_value_b</span><span class="p">,</span> <span class="n">new_class_name</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="p">):</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply enclosed-by logic to identify and reclassify segments.</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">    source_layer : Layer</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">        The source spatial layer containing segments.</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">    class_column_name : str</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">        The name of the column containing class labels (e.g., &quot;veg_class&quot;).</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">    class_value_a : str</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">        The class value to check for enclosure (target to reclassify).</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">    class_value_b : str</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">        The class value expected to surround class A segments.</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">    new_class_name : str</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">        The new class name to assign to enclosed segments.</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">    layer_manager : LayerManager, optional</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">        Optional manager to register the resulting layer.</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">    layer_name : str, optional</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">        Optional name for the result layer.</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">    --------</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">    result_layer : Layer</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">        A new layer with updated class values for enclosed segments.</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_name</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="n">layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source_layer</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="n">result_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source_layer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;merged&quot;</span><span class="p">)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>    <span class="n">surrounded_segments</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>    <span class="n">geom_map</span><span class="p">,</span> <span class="n">class_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_layer</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">)</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>    <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="k">if</span> <span class="n">class_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span> <span class="o">!=</span> <span class="n">class_value_a</span><span class="p">:</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>            <span class="k">continue</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_neighbors</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">geom_map</span><span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="k">if</span> <span class="n">neighbors</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">class_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n_id</span><span class="p">)</span> <span class="o">==</span> <span class="n">class_value_b</span> <span class="k">for</span> <span class="n">n_id</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">):</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>            <span class="n">surrounded_segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">surrounded_segments</span><span class="p">)),</span> <span class="n">class_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_class_name</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">df</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="s2">&quot;enclosed_by_ruleset_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="p">}</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>        <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>    <span class="k">return</span> <span class="n">result_layer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="nickyspatial.core.rules.MergeRuleSet" class="doc doc-heading">
            <code>MergeRuleSet</code>


<a href="#nickyspatial.core.rules.MergeRuleSet" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CommonBase (nickyspatial.core.rules.CommonBase)" href="#nickyspatial.core.rules.CommonBase">CommonBase</a></code></p>


        <p>A rule set for merging segments of the same class based on specified class values.</p>







              <details class="quote">
                <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="k">class</span><span class="w"> </span><span class="nc">MergeRuleSet</span><span class="p">(</span><span class="n">CommonBase</span><span class="p">):</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A rule set for merging segments of the same class based on specified class values.&quot;&quot;&quot;</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the merge rule set.</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">        name : str, optional</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">            Name of the merge rule set</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="s2">&quot;MergeRuleSet&quot;</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">,</span> <span class="n">class_value</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge segments of the same class in a layer.</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">        source_layer : Layer</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">            Source layer with segments to merge</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">        class_value : str or list of str</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">            One or more attribute field names to group and merge segments</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">        layer_manager : LayerManager, optional</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">            Layer manager to add the result layer to</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">        layer_name : str, optional</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">            Name for the result layer</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">        --------</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">        result_layer : Layer</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">            Layer with merged geometries</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_name</span><span class="p">:</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>            <span class="n">layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source_layer</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="n">result_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source_layer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;merged&quot;</span><span class="p">)</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="c1"># Handle single or multiple class fields</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">class_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="n">class_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">class_value</span><span class="p">]</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="n">class_values</span> <span class="o">=</span> <span class="n">class_value</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="n">new_rows</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="n">to_drop</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="n">geom_map</span><span class="p">,</span> <span class="n">class_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_layer</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">)</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="k">for</span> <span class="n">class_value</span> <span class="ow">in</span> <span class="n">class_values</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="n">visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>            <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                <span class="k">if</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">visited</span> <span class="ow">or</span> <span class="n">class_map</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="o">!=</span> <span class="n">class_value</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                <span class="n">group_geom</span> <span class="o">=</span> <span class="p">[</span><span class="n">geom_map</span><span class="p">[</span><span class="n">sid</span><span class="p">]]</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">sid</span><span class="p">]</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                <span class="n">queue</span> <span class="o">=</span> <span class="p">[</span><span class="n">sid</span><span class="p">]</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                <span class="k">while</span> <span class="n">queue</span><span class="p">:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                    <span class="n">current_id</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>                    <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_neighbors</span><span class="p">(</span><span class="n">current_id</span><span class="p">,</span> <span class="n">geom_map</span><span class="p">)</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                    <span class="k">for</span> <span class="n">n_id</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">:</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                        <span class="k">if</span> <span class="n">n_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span> <span class="ow">and</span> <span class="n">class_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n_id</span><span class="p">)</span> <span class="o">==</span> <span class="n">class_value</span><span class="p">:</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>                            <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">n_id</span><span class="p">)</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>                            <span class="n">group_geom</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geom_map</span><span class="p">[</span><span class="n">n_id</span><span class="p">])</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>                            <span class="n">group_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_id</span><span class="p">)</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                            <span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_id</span><span class="p">)</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>                <span class="n">merged_geom</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">group_geom</span><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>                <span class="n">row_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;segment_id&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">group_ids</span><span class="p">),</span> <span class="n">class_column_name</span><span class="p">:</span> <span class="n">class_value</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">merged_geom</span><span class="p">}</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>                <span class="n">new_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>                <span class="n">to_drop</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">to_drop</span><span class="p">)]</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_rows</span><span class="p">)],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">df</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="s2">&quot;mergeruleset_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>            <span class="s2">&quot;merged_fields&quot;</span><span class="p">:</span> <span class="n">class_values</span><span class="p">,</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="p">}</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="k">return</span> <span class="n">result_layer</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.rules.MergeRuleSet.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.core.rules.MergeRuleSet.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize the merge rule set.</p>
<h5 id="nickyspatial.core.rules.MergeRuleSet.__init__--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.rules.MergeRuleSet.__init__--parameters" title="Permanent link">&para;</a></h5>
<p>name : str, optional
    Name of the merge rule set</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the merge rule set.</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">    name : str, optional</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">        Name of the merge rule set</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="s2">&quot;MergeRuleSet&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.rules.MergeRuleSet.execute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">,</span> <span class="n">class_value</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.core.rules.MergeRuleSet.execute" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Merge segments of the same class in a layer.</p>
<h5 id="nickyspatial.core.rules.MergeRuleSet.execute--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.rules.MergeRuleSet.execute--parameters" title="Permanent link">&para;</a></h5>
<p>source_layer : Layer
    Source layer with segments to merge
class_value : str or list of str
    One or more attribute field names to group and merge segments
layer_manager : LayerManager, optional
    Layer manager to add the result layer to
layer_name : str, optional
    Name for the result layer</p>
<h5 id="nickyspatial.core.rules.MergeRuleSet.execute--returns">Returns:<a class="headerlink" href="#nickyspatial.core.rules.MergeRuleSet.execute--returns" title="Permanent link">&para;</a></h5>
<p>result_layer : Layer
    Layer with merged geometries</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">,</span> <span class="n">class_value</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge segments of the same class in a layer.</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">    source_layer : Layer</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">        Source layer with segments to merge</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">    class_value : str or list of str</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">        One or more attribute field names to group and merge segments</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">    layer_manager : LayerManager, optional</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">        Layer manager to add the result layer to</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">    layer_name : str, optional</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">        Name for the result layer</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">    --------</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">    result_layer : Layer</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">        Layer with merged geometries</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_name</span><span class="p">:</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="n">layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source_layer</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="n">result_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source_layer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;merged&quot;</span><span class="p">)</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="c1"># Handle single or multiple class fields</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">class_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="n">class_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">class_value</span><span class="p">]</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="n">class_values</span> <span class="o">=</span> <span class="n">class_value</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="n">new_rows</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="n">to_drop</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="n">geom_map</span><span class="p">,</span> <span class="n">class_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_layer</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">)</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="k">for</span> <span class="n">class_value</span> <span class="ow">in</span> <span class="n">class_values</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="n">visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="k">if</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">visited</span> <span class="ow">or</span> <span class="n">class_map</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="o">!=</span> <span class="n">class_value</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>                <span class="k">continue</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="n">group_geom</span> <span class="o">=</span> <span class="p">[</span><span class="n">geom_map</span><span class="p">[</span><span class="n">sid</span><span class="p">]]</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">sid</span><span class="p">]</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>            <span class="n">queue</span> <span class="o">=</span> <span class="p">[</span><span class="n">sid</span><span class="p">]</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>            <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>            <span class="k">while</span> <span class="n">queue</span><span class="p">:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                <span class="n">current_id</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>                <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_neighbors</span><span class="p">(</span><span class="n">current_id</span><span class="p">,</span> <span class="n">geom_map</span><span class="p">)</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                <span class="k">for</span> <span class="n">n_id</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">:</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                    <span class="k">if</span> <span class="n">n_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span> <span class="ow">and</span> <span class="n">class_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n_id</span><span class="p">)</span> <span class="o">==</span> <span class="n">class_value</span><span class="p">:</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>                        <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">n_id</span><span class="p">)</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>                        <span class="n">group_geom</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geom_map</span><span class="p">[</span><span class="n">n_id</span><span class="p">])</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>                        <span class="n">group_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_id</span><span class="p">)</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                        <span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_id</span><span class="p">)</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>            <span class="n">merged_geom</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">group_geom</span><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="n">row_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;segment_id&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">group_ids</span><span class="p">),</span> <span class="n">class_column_name</span><span class="p">:</span> <span class="n">class_value</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">merged_geom</span><span class="p">}</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="n">new_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="n">to_drop</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">to_drop</span><span class="p">)]</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_rows</span><span class="p">)],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">df</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="s2">&quot;mergeruleset_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="s2">&quot;merged_fields&quot;</span><span class="p">:</span> <span class="n">class_values</span><span class="p">,</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="p">}</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="k">return</span> <span class="n">result_layer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="nickyspatial.core.rules.Rule" class="doc doc-heading">
            <code>Rule</code>


<a href="#nickyspatial.core.rules.Rule" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>A rule defines a condition to classify segments.</p>







              <details class="quote">
                <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="k">class</span><span class="w"> </span><span class="nc">Rule</span><span class="p">:</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A rule defines a condition to classify segments.&quot;&quot;&quot;</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">class_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a rule.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        name : str</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">            Name of the rule</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        condition : str</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">            Condition as a string expression that can be evaluated using numexpr</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        class_value : str, optional</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            Value to assign when the condition is met.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">            If None, uses the rule name.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_value</span> <span class="o">=</span> <span class="n">class_value</span> <span class="k">if</span> <span class="n">class_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;String representation of the rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Rule &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">class_value</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.rules.Rule.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">class_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.core.rules.Rule.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize a rule.</p>
<h5 id="nickyspatial.core.rules.Rule.__init__--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.rules.Rule.__init__--parameters" title="Permanent link">&para;</a></h5>
<p>name : str
    Name of the rule
condition : str
    Condition as a string expression that can be evaluated using numexpr
class_value : str, optional
    Value to assign when the condition is met.
    If None, uses the rule name.</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">class_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize a rule.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    name : str</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        Name of the rule</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    condition : str</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        Condition as a string expression that can be evaluated using numexpr</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    class_value : str, optional</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        Value to assign when the condition is met.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        If None, uses the rule name.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">class_value</span> <span class="o">=</span> <span class="n">class_value</span> <span class="k">if</span> <span class="n">class_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.rules.Rule.__str__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__str__</span><span class="p">()</span></code>

<a href="#nickyspatial.core.rules.Rule.__str__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>String representation of the rule.</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;String representation of the rule.&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Rule &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">class_value</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="nickyspatial.core.rules.RuleSet" class="doc doc-heading">
            <code>RuleSet</code>


<a href="#nickyspatial.core.rules.RuleSet" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>A collection of rules to apply to a layer.</p>







              <details class="quote">
                <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="k">class</span><span class="w"> </span><span class="nc">RuleSet</span><span class="p">:</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A collection of rules to apply to a layer.&quot;&quot;&quot;</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a rule set.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        name : str, optional</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            Name of the rule set</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="s2">&quot;RuleSet&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">wrap_condition_parts_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">):</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrap condition parts with parentheses for evaluation.&quot;&quot;&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="n">parts</span> <span class="o">=</span> <span class="n">condition</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">]</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="k">return</span> <span class="s2">&quot; &amp; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">class_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a rule to the rule set.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        name : str</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            Name of the rule</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        condition : str</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            Condition as a string expression that can be evaluated using numexpr</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        class_value : str, optional</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">            Value to assign when the condition is met</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        --------</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        rule : Rule</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            The added rule</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="n">rule</span> <span class="o">=</span> <span class="n">Rule</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">class_value</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="k">return</span> <span class="n">rule</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the list of rules in the rule set.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        --------</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        list of tuples</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">            List of (name, condition) tuples for each rule</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="k">return</span> <span class="p">[(</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">rule</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">]</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">source_layer</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="n">result_field</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply rules to classify segments in a layer.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        source_layer : Layer</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">            Source layer with segments to classify</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        layer_manager : LayerManager, optional</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">            Layer manager to add the result layer to</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        layer_name : str, optional</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">            Name for the result layer</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        result_field : str</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">            Field name to store classification results</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        --------</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        result_layer : Layer</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">            Layer with classification results</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_name</span><span class="p">:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="n">layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source_layer</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">result_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source_layer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="k">if</span> <span class="n">result_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">result_field</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="s2">&quot;ruleset_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="s2">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>                <span class="p">{</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                    <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                    <span class="s2">&quot;class_value&quot;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">class_value</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="p">}</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="p">],</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="s2">&quot;result_field&quot;</span><span class="p">:</span> <span class="n">result_field</span><span class="p">,</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="p">}</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                <span class="k">if</span> <span class="n">result_field</span> <span class="ow">in</span> <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result_field</span><span class="si">}</span><span class="s2"> ==&quot;</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">condition</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                    <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result_field</span><span class="si">}</span><span class="s2">==&quot;</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">condition</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                    <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result_field</span><span class="si">}</span><span class="s2"> !=&quot;</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">condition</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                    <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result_field</span><span class="si">}</span><span class="s2">!=&quot;</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">condition</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="p">):</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                    <span class="c1">## TODO : better way to handle this , because &amp; searching in string is not a good idea,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                    <span class="c1"># this might produce bug for complex rules</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                    <span class="n">eval_condition</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">condition</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot; and &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot; or &quot;</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                    <span class="n">mask</span> <span class="o">=</span> <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                        <span class="k">lambda</span> <span class="n">row</span><span class="p">,</span> <span class="n">cond</span><span class="o">=</span><span class="n">eval_condition</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                            <span class="n">cond</span><span class="p">,</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                            <span class="p">{</span><span class="s2">&quot;__builtins__&quot;</span><span class="p">:</span> <span class="p">{}},</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                            <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;geometry&quot;</span><span class="p">},</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                        <span class="p">),</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                    <span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                        <span class="n">local_dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                            <span class="n">col</span><span class="p">:</span> <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;geometry&quot;</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                        <span class="p">}</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>                        <span class="n">mask</span> <span class="o">=</span> <span class="n">ne</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span> <span class="n">local_dict</span><span class="o">=</span><span class="n">local_dict</span><span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>                        <span class="n">mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                        <span class="n">mask</span> <span class="o">=</span> <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">result_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">class_value</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error applying rule &#39;</span><span class="si">{</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>                <span class="k">continue</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>            <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="k">return</span> <span class="n">result_layer</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.rules.RuleSet.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.core.rules.RuleSet.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize a rule set.</p>
<h5 id="nickyspatial.core.rules.RuleSet.__init__--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.rules.RuleSet.__init__--parameters" title="Permanent link">&para;</a></h5>
<p>name : str, optional
    Name of the rule set</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize a rule set.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    name : str, optional</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        Name of the rule set</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="s2">&quot;RuleSet&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.rules.RuleSet.add_rule" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_rule</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">class_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.core.rules.RuleSet.add_rule" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add a rule to the rule set.</p>
<h5 id="nickyspatial.core.rules.RuleSet.add_rule--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.rules.RuleSet.add_rule--parameters" title="Permanent link">&para;</a></h5>
<p>name : str
    Name of the rule
condition : str
    Condition as a string expression that can be evaluated using numexpr
class_value : str, optional
    Value to assign when the condition is met</p>
<h5 id="nickyspatial.core.rules.RuleSet.add_rule--returns">Returns:<a class="headerlink" href="#nickyspatial.core.rules.RuleSet.add_rule--returns" title="Permanent link">&para;</a></h5>
<p>rule : Rule
    The added rule</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">class_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a rule to the rule set.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    name : str</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        Name of the rule</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    condition : str</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        Condition as a string expression that can be evaluated using numexpr</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    class_value : str, optional</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        Value to assign when the condition is met</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    --------</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    rule : Rule</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        The added rule</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="n">rule</span> <span class="o">=</span> <span class="n">Rule</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">class_value</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="k">return</span> <span class="n">rule</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.rules.RuleSet.execute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">result_field</span><span class="o">=</span><span class="s1">&#39;classification&#39;</span><span class="p">)</span></code>

<a href="#nickyspatial.core.rules.RuleSet.execute" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply rules to classify segments in a layer.</p>
<h5 id="nickyspatial.core.rules.RuleSet.execute--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.rules.RuleSet.execute--parameters" title="Permanent link">&para;</a></h5>
<p>source_layer : Layer
    Source layer with segments to classify
layer_manager : LayerManager, optional
    Layer manager to add the result layer to
layer_name : str, optional
    Name for the result layer
result_field : str
    Field name to store classification results</p>
<h5 id="nickyspatial.core.rules.RuleSet.execute--returns">Returns:<a class="headerlink" href="#nickyspatial.core.rules.RuleSet.execute--returns" title="Permanent link">&para;</a></h5>
<p>result_layer : Layer
    Layer with classification results</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">source_layer</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="n">result_field</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply rules to classify segments in a layer.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    source_layer : Layer</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        Source layer with segments to classify</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    layer_manager : LayerManager, optional</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        Layer manager to add the result layer to</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">    layer_name : str, optional</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        Name for the result layer</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">    result_field : str</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        Field name to store classification results</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    --------</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    result_layer : Layer</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        Layer with classification results</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_name</span><span class="p">:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source_layer</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">result_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source_layer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="k">if</span> <span class="n">result_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">result_field</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="s2">&quot;ruleset_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="s2">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="p">{</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="s2">&quot;class_value&quot;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">class_value</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="p">}</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="p">],</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="s2">&quot;result_field&quot;</span><span class="p">:</span> <span class="n">result_field</span><span class="p">,</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="p">}</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="k">if</span> <span class="n">result_field</span> <span class="ow">in</span> <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result_field</span><span class="si">}</span><span class="s2"> ==&quot;</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">condition</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result_field</span><span class="si">}</span><span class="s2">==&quot;</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">condition</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result_field</span><span class="si">}</span><span class="s2"> !=&quot;</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">condition</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result_field</span><span class="si">}</span><span class="s2">!=&quot;</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">condition</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="p">):</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="c1">## TODO : better way to handle this , because &amp; searching in string is not a good idea,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="c1"># this might produce bug for complex rules</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                <span class="n">eval_condition</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">condition</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot; and &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot; or &quot;</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                    <span class="k">lambda</span> <span class="n">row</span><span class="p">,</span> <span class="n">cond</span><span class="o">=</span><span class="n">eval_condition</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                        <span class="n">cond</span><span class="p">,</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                        <span class="p">{</span><span class="s2">&quot;__builtins__&quot;</span><span class="p">:</span> <span class="p">{}},</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                        <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;geometry&quot;</span><span class="p">},</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                    <span class="p">),</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                <span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                    <span class="n">local_dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                        <span class="n">col</span><span class="p">:</span> <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;geometry&quot;</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                    <span class="p">}</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>                    <span class="n">mask</span> <span class="o">=</span> <span class="n">ne</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span> <span class="n">local_dict</span><span class="o">=</span><span class="n">local_dict</span><span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>                    <span class="n">mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                    <span class="n">mask</span> <span class="o">=</span> <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">result_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">class_value</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error applying rule &#39;</span><span class="si">{</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="k">continue</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="k">return</span> <span class="n">result_layer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.rules.RuleSet.get_rules" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_rules</span><span class="p">()</span></code>

<a href="#nickyspatial.core.rules.RuleSet.get_rules" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the list of rules in the rule set.</p>
<h5 id="nickyspatial.core.rules.RuleSet.get_rules--returns">Returns:<a class="headerlink" href="#nickyspatial.core.rules.RuleSet.get_rules--returns" title="Permanent link">&para;</a></h5>
<p>list of tuples
    List of (name, condition) tuples for each rule</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span>
<span class="normal"><a href="#__codelineno-0-97">97</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the list of rules in the rule set.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    --------</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    list of tuples</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        List of (name, condition) tuples for each rule</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="k">return</span> <span class="p">[(</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">rule</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.rules.RuleSet.wrap_condition_parts_simple" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wrap_condition_parts_simple</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#nickyspatial.core.rules.RuleSet.wrap_condition_parts_simple" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Wrap condition parts with parentheses for evaluation.</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="k">def</span><span class="w"> </span><span class="nf">wrap_condition_parts_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">):</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrap condition parts with parentheses for evaluation.&quot;&quot;&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">parts</span> <span class="o">=</span> <span class="n">condition</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">]</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">return</span> <span class="s2">&quot; &amp; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="nickyspatial.core.rules.TouchedByRuleSet" class="doc doc-heading">
            <code>TouchedByRuleSet</code>


<a href="#nickyspatial.core.rules.TouchedByRuleSet" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CommonBase (nickyspatial.core.rules.CommonBase)" href="#nickyspatial.core.rules.CommonBase">CommonBase</a></code></p>


        <p>A rule set to reclassify segments based on spatial enclosure.</p>
<p>This rule set identifies segments of one class (A) that are entirely surrounded
by segments of another class (B), and reclassifies them into a new class.</p>







              <details class="quote">
                <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="k">class</span><span class="w"> </span><span class="nc">TouchedByRuleSet</span><span class="p">(</span><span class="n">CommonBase</span><span class="p">):</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A rule set to reclassify segments based on spatial enclosure.</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">    This rule set identifies segments of one class (A) that are entirely surrounded</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">    by segments of another class (B), and reclassifies them into a new class.</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the merge rule set.</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">        name : str, optional</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">            Name of the merge rule set</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="s2">&quot;TouchedByRuleSet&quot;</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">source_layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">,</span> <span class="n">class_value_a</span><span class="p">,</span> <span class="n">class_value_b</span><span class="p">,</span> <span class="n">new_class_name</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>    <span class="p">):</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes the merge rule set by identifying and updating segments of a given class that are adjacent to another class!</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">        - source_layer: Layer</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">            The input layer containing segment geometries and attributes.</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">        - class_column_name: str</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">            The name of the column containing class labels.</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">        - class_value_a: str or int</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">            The class value of segments to be checked for touching neighbors.</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">        - class_value_b: str or int</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">            The class value of neighboring segments that would trigger a merge.</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">        - new_class_name: str</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">            The new class value to assign to segments of class_value_a that touch class_value_b.</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">        - layer_manager: optional</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">            An optional manager for adding the resulting layer to a collection or interface.</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">        - layer_name: optional</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">            Optional custom name for the resulting layer. Defaults to &quot;&lt;source_layer_name&gt;_&lt;ruleset_name&gt;&quot;.</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">        - result_layer: Layer</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">            A new Layer object with updated segment classifications where applicable.</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">        Logic:</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">        - Copies the source layer and initializes a new result layer.</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">        - Preprocesses the source layer to build geometry and class lookup maps.</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">        - Iterates through each segment of class_value_a, checking if any of its neighbors belong to class_value_b.</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">        - If so, updates the segment&#39;s class to new_class_name.</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">        - Stores the modified DataFrame in the result layer and optionally registers it via the layer_manager.</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_name</span><span class="p">:</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>            <span class="n">layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source_layer</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="n">result_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source_layer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;merged&quot;</span><span class="p">)</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="n">touched_segments</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="n">geom_map</span><span class="p">,</span> <span class="n">class_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_layer</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">)</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>            <span class="k">if</span> <span class="n">class_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span> <span class="o">!=</span> <span class="n">class_value_a</span><span class="p">:</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>                <span class="k">continue</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>            <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_neighbors</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">geom_map</span><span class="p">)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="k">if</span> <span class="n">neighbors</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">class_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n_id</span><span class="p">)</span> <span class="o">==</span> <span class="n">class_value_b</span> <span class="k">for</span> <span class="n">n_id</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">):</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>                <span class="n">touched_segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">touched_segments</span><span class="p">)),</span> <span class="n">class_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_class_name</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">df</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>            <span class="s2">&quot;enclosed_by_ruleset_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>        <span class="p">}</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>        <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>            <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="k">return</span> <span class="n">result_layer</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.rules.TouchedByRuleSet.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.core.rules.TouchedByRuleSet.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize the merge rule set.</p>
<h5 id="nickyspatial.core.rules.TouchedByRuleSet.__init__--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.rules.TouchedByRuleSet.__init__--parameters" title="Permanent link">&para;</a></h5>
<p>name : str, optional
    Name of the merge rule set</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the merge rule set.</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">    name : str, optional</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">        Name of the merge rule set</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="s2">&quot;TouchedByRuleSet&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.rules.TouchedByRuleSet.execute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">,</span> <span class="n">class_value_a</span><span class="p">,</span> <span class="n">class_value_b</span><span class="p">,</span> <span class="n">new_class_name</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.core.rules.TouchedByRuleSet.execute" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Executes the merge rule set by identifying and updating segments of a given class that are adjacent to another class!</p>
        <ul>
<li>source_layer: Layer
    The input layer containing segment geometries and attributes.</li>
<li>class_column_name: str
    The name of the column containing class labels.</li>
<li>class_value_a: str or int
    The class value of segments to be checked for touching neighbors.</li>
<li>class_value_b: str or int
    The class value of neighboring segments that would trigger a merge.</li>
<li>new_class_name: str
    The new class value to assign to segments of class_value_a that touch class_value_b.</li>
<li>layer_manager: optional
    An optional manager for adding the resulting layer to a collection or interface.</li>
<li>layer_name: optional
    Optional custom name for the resulting layer. Defaults to "<source_layer_name>_<ruleset_name>".</li>
</ul>
        <ul>
<li>result_layer: Layer
    A new Layer object with updated segment classifications where applicable.</li>
</ul>
<p>Logic:
- Copies the source layer and initializes a new result layer.
- Preprocesses the source layer to build geometry and class lookup maps.
- Iterates through each segment of class_value_a, checking if any of its neighbors belong to class_value_b.
- If so, updates the segment's class to new_class_name.
- Stores the modified DataFrame in the result layer and optionally registers it via the layer_manager.</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">source_layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">,</span> <span class="n">class_value_a</span><span class="p">,</span> <span class="n">class_value_b</span><span class="p">,</span> <span class="n">new_class_name</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="p">):</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Executes the merge rule set by identifying and updating segments of a given class that are adjacent to another class!</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">    - source_layer: Layer</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">        The input layer containing segment geometries and attributes.</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">    - class_column_name: str</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">        The name of the column containing class labels.</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">    - class_value_a: str or int</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">        The class value of segments to be checked for touching neighbors.</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">    - class_value_b: str or int</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">        The class value of neighboring segments that would trigger a merge.</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">    - new_class_name: str</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">        The new class value to assign to segments of class_value_a that touch class_value_b.</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">    - layer_manager: optional</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">        An optional manager for adding the resulting layer to a collection or interface.</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">    - layer_name: optional</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">        Optional custom name for the resulting layer. Defaults to &quot;&lt;source_layer_name&gt;_&lt;ruleset_name&gt;&quot;.</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">    - result_layer: Layer</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">        A new Layer object with updated segment classifications where applicable.</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">    Logic:</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">    - Copies the source layer and initializes a new result layer.</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    - Preprocesses the source layer to build geometry and class lookup maps.</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">    - Iterates through each segment of class_value_a, checking if any of its neighbors belong to class_value_b.</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">    - If so, updates the segment&#39;s class to new_class_name.</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">    - Stores the modified DataFrame in the result layer and optionally registers it via the layer_manager.</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_name</span><span class="p">:</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>        <span class="n">layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source_layer</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="n">result_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source_layer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;merged&quot;</span><span class="p">)</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>    <span class="n">touched_segments</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>    <span class="n">geom_map</span><span class="p">,</span> <span class="n">class_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_layer</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">class_column_name</span><span class="p">)</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="k">if</span> <span class="n">class_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span> <span class="o">!=</span> <span class="n">class_value_a</span><span class="p">:</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>            <span class="k">continue</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_neighbors</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">geom_map</span><span class="p">)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="k">if</span> <span class="n">neighbors</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">class_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n_id</span><span class="p">)</span> <span class="o">==</span> <span class="n">class_value_b</span> <span class="k">for</span> <span class="n">n_id</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">):</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="n">touched_segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">touched_segments</span><span class="p">)),</span> <span class="n">class_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_class_name</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">df</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="s2">&quot;enclosed_by_ruleset_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="p">}</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>    <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>        <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>    <span class="k">return</span> <span class="n">result_layer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="nickyspatial.core.segmentation"></a>
    <div class="doc doc-contents first">

        <p>Implements segmentation algorithms to partition images into meaningful region objects.</p>
<p>The functions here might apply clustering or region-growing techniques, aiding object-based remote sensing analysis.
This module includes the SlicSegmentation class, which implements a bottom-up region-growing algorithm</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="nickyspatial.core.segmentation.SlicSegmentation" class="doc doc-heading">
            <code>SlicSegmentation</code>


<a href="#nickyspatial.core.segmentation.SlicSegmentation" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Implementation of Multiresolution segmentation algorithm.</p>
<p>This algorithm segments an image using a bottom-up region-growing approach
that optimizes the homogeneity of pixel values within segments while
considering shape compactness.</p>







              <details class="quote">
                <summary>Source code in <code>nickyspatial/core/segmentation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">class</span><span class="w"> </span><span class="nc">SlicSegmentation</span><span class="p">:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Implementation of Multiresolution segmentation algorithm.</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    This algorithm segments an image using a bottom-up region-growing approach</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    that optimizes the homogeneity of pixel values within segments while</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    considering shape compactness.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">compactness</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the segmentation algorithm.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        scale : float</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">            Scale parameter that influences the size of the segments.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">            Higher values create larger segments.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        shape : float, range [0, 1]</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">            Weight of shape criterion vs. color criterion.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">            Higher values give more weight to shape.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        compactness : float, range [0, 1]</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">            Weight of compactness criterion vs. smoothness criterion.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">            Higher values create more compact segments.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">compactness</span> <span class="o">=</span> <span class="n">compactness</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_data</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform segmentation and create a layer with the results.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        image_data : numpy.ndarray</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">            Array with raster data values (bands, height, width)</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        transform : affine.Affine</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">            Affine transformation for the raster</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        crs : rasterio.crs.CRS</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            Coordinate reference system</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        layer_manager : LayerManager, optional</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            Layer manager to add the result layer to</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        layer_name : str, optional</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            Name for the result layer</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        --------</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        layer : Layer</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            Layer containing the segmentation results</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="n">num_bands</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">image_data</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">normalized_bands</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bands</span><span class="p">):</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>            <span class="n">band</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>            <span class="k">if</span> <span class="n">band</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="n">band</span><span class="o">.</span><span class="n">min</span><span class="p">():</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>                <span class="n">normalized_bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">band</span><span class="p">))</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>                <span class="k">continue</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="n">norm_band</span> <span class="o">=</span> <span class="p">(</span><span class="n">band</span> <span class="o">-</span> <span class="n">band</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">band</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">band</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="n">normalized_bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">norm_band</span><span class="p">)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="n">multichannel_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">normalized_bands</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">n_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">height</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">))</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of segments: </span><span class="si">{</span><span class="n">n_segments</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="n">segments</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">slic</span><span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>                <span class="n">multichannel_image</span><span class="p">,</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>                <span class="n">n_segments</span><span class="o">=</span><span class="n">n_segments</span><span class="p">,</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="n">compactness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compactness</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>                <span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="n">start_label</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>                <span class="n">channel_axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_name</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="n">layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Segmentation_scale</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="si">}</span><span class="s2">_comp</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">compactness</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="n">layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="n">layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">segments</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">crs</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="s2">&quot;compactness&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">compactness</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="s2">&quot;n_segments&quot;</span><span class="p">:</span> <span class="n">n_segments</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="s2">&quot;num_segments_actual&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">segments</span><span class="p">)),</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="p">}</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">segment_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_segment_objects</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">crs</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">segment_objects</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;band_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bands</span><span class="p">)]</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_statistics</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">image_data</span><span class="p">,</span> <span class="n">bands</span><span class="p">)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="k">return</span> <span class="n">layer</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_segment_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segments</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">crs</span><span class="p">):</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create vector objects from segments.</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        segments : numpy.ndarray</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">            Array with segment IDs</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        transform : affine.Affine</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">            Affine transformation for the raster</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        crs : rasterio.crs.CRS</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">            Coordinate reference system</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        --------</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        segment_objects : geopandas.GeoDataFrame</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">            GeoDataFrame with segment polygons</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">segment_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">geometries</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">properties</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="k">for</span> <span class="n">segment_id</span> <span class="ow">in</span> <span class="n">segment_ids</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">segments</span> <span class="o">==</span> <span class="n">segment_id</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                <span class="k">continue</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="n">shapes</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shapes</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">),</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="n">segment_polygons</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="k">for</span> <span class="n">geom</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                        <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                        <span class="k">if</span> <span class="n">polygon</span><span class="o">.</span><span class="n">is_valid</span><span class="p">:</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                            <span class="n">segment_polygons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                        <span class="k">continue</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">segment_polygons</span><span class="p">:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                <span class="k">continue</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">largest_polygon</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">segment_polygons</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="n">area_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="n">pixel_width</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">transform</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="n">pixel_height</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">transform</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="n">area_units</span> <span class="o">=</span> <span class="n">area_pixels</span> <span class="o">*</span> <span class="n">pixel_width</span> <span class="o">*</span> <span class="n">pixel_height</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="n">prop</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                <span class="s2">&quot;segment_id&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">segment_id</span><span class="p">),</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                <span class="s2">&quot;area_pixels&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">area_pixels</span><span class="p">),</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                <span class="s2">&quot;area_units&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">area_units</span><span class="p">),</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="p">}</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="n">geometries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">largest_polygon</span><span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="n">properties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">geometries</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="k">return</span> <span class="n">gdf</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">image_data</span><span class="p">,</span> <span class="n">bands</span><span class="p">):</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate statistics for segments based on image data.</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">        -----------</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">        layer : Layer</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">            Layer containing segments</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        image_data : numpy.ndarray</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">            Array with raster data values (bands, height, width)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        bands : list of str</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">            Names of the bands</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">segments</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="n">segment_objects</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="n">segment_ids</span> <span class="o">=</span> <span class="n">segment_objects</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">band_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands</span><span class="p">):</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">image_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                <span class="k">break</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="n">band_data</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="k">for</span> <span class="n">segment_id</span> <span class="ow">in</span> <span class="n">segment_ids</span><span class="p">:</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">segments</span> <span class="o">==</span> <span class="n">segment_id</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                <span class="k">if</span> <span class="n">segment_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">segment_objects</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                <span class="n">segment_pixels</span> <span class="o">=</span> <span class="n">band_data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment_pixels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>                <span class="n">mean_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">segment_pixels</span><span class="p">))</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                <span class="n">std_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">segment_pixels</span><span class="p">))</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                <span class="n">min_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">segment_pixels</span><span class="p">))</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                <span class="n">max_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">segment_pixels</span><span class="p">))</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>                <span class="n">median_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">segment_pixels</span><span class="p">))</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>                <span class="n">idx</span> <span class="o">=</span> <span class="n">segment_objects</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">segment_objects</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">segment_id</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>                <span class="n">segment_objects</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">band_name</span><span class="si">}</span><span class="s2">_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_val</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                <span class="n">segment_objects</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">band_name</span><span class="si">}</span><span class="s2">_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">std_val</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                <span class="n">segment_objects</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">band_name</span><span class="si">}</span><span class="s2">_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_val</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                <span class="n">segment_objects</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">band_name</span><span class="si">}</span><span class="s2">_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_val</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>                <span class="n">segment_objects</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">band_name</span><span class="si">}</span><span class="s2">_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">median_val</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.segmentation.SlicSegmentation.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">compactness</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span></code>

<a href="#nickyspatial.core.segmentation.SlicSegmentation.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize the segmentation algorithm.</p>
<h5 id="nickyspatial.core.segmentation.SlicSegmentation.__init__--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.segmentation.SlicSegmentation.__init__--parameters" title="Permanent link">&para;</a></h5>
<p>scale : float
    Scale parameter that influences the size of the segments.
    Higher values create larger segments.
shape : float, range [0, 1]
    Weight of shape criterion vs. color criterion.
    Higher values give more weight to shape.
compactness : float, range [0, 1]
    Weight of compactness criterion vs. smoothness criterion.
    Higher values create more compact segments.</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">compactness</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the segmentation algorithm.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    scale : float</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        Scale parameter that influences the size of the segments.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        Higher values create larger segments.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    shape : float, range [0, 1]</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        Weight of shape criterion vs. color criterion.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        Higher values give more weight to shape.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    compactness : float, range [0, 1]</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        Weight of compactness criterion vs. smoothness criterion.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        Higher values create more compact segments.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">compactness</span> <span class="o">=</span> <span class="n">compactness</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nickyspatial.core.segmentation.SlicSegmentation.execute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute</span><span class="p">(</span><span class="n">image_data</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.core.segmentation.SlicSegmentation.execute" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Perform segmentation and create a layer with the results.</p>
<h5 id="nickyspatial.core.segmentation.SlicSegmentation.execute--parameters">Parameters:<a class="headerlink" href="#nickyspatial.core.segmentation.SlicSegmentation.execute--parameters" title="Permanent link">&para;</a></h5>
<p>image_data : numpy.ndarray
    Array with raster data values (bands, height, width)
transform : affine.Affine
    Affine transformation for the raster
crs : rasterio.crs.CRS
    Coordinate reference system
layer_manager : LayerManager, optional
    Layer manager to add the result layer to
layer_name : str, optional
    Name for the result layer</p>
<h5 id="nickyspatial.core.segmentation.SlicSegmentation.execute--returns">Returns:<a class="headerlink" href="#nickyspatial.core.segmentation.SlicSegmentation.execute--returns" title="Permanent link">&para;</a></h5>
<p>layer : Layer
    Layer containing the segmentation results</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/core/segmentation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_data</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform segmentation and create a layer with the results.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    image_data : numpy.ndarray</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        Array with raster data values (bands, height, width)</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    transform : affine.Affine</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        Affine transformation for the raster</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    crs : rasterio.crs.CRS</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        Coordinate reference system</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    layer_manager : LayerManager, optional</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        Layer manager to add the result layer to</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    layer_name : str, optional</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        Name for the result layer</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    --------</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        Layer containing the segmentation results</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">num_bands</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">image_data</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">normalized_bands</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bands</span><span class="p">):</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="n">band</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="k">if</span> <span class="n">band</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="n">band</span><span class="o">.</span><span class="n">min</span><span class="p">():</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="n">normalized_bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">band</span><span class="p">))</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>            <span class="k">continue</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="n">norm_band</span> <span class="o">=</span> <span class="p">(</span><span class="n">band</span> <span class="o">-</span> <span class="n">band</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">band</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">band</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="n">normalized_bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">norm_band</span><span class="p">)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="n">multichannel_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">normalized_bands</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="n">n_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">height</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">))</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of segments: </span><span class="si">{</span><span class="n">n_segments</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="n">segments</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">slic</span><span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="n">multichannel_image</span><span class="p">,</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="n">n_segments</span><span class="o">=</span><span class="n">n_segments</span><span class="p">,</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="n">compactness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compactness</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">start_label</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">channel_axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_name</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="n">layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Segmentation_scale</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="si">}</span><span class="s2">_comp</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">compactness</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;segmentation&quot;</span><span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">segments</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">crs</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="n">layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="s2">&quot;compactness&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">compactness</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="s2">&quot;n_segments&quot;</span><span class="p">:</span> <span class="n">n_segments</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="s2">&quot;num_segments_actual&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">segments</span><span class="p">)),</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="p">}</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="n">segment_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_segment_objects</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">crs</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">segment_objects</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;band_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bands</span><span class="p">)]</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_statistics</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">image_data</span><span class="p">,</span> <span class="n">bands</span><span class="p">)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">return</span> <span class="n">layer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="nickyspatialfilters"><code>nickyspatial.filters</code><a class="headerlink" href="#nickyspatialfilters" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<a id="nickyspatial.filters"></a>
    <div class="doc doc-contents first">

        <p>The filters package provides modules for applying transformations to raster data.</p>
<p>It includes spatial filters (e.g., smoothing) as well as spectral filters (e.g., band math).
Main idea is to further manipulate the objects such as merging segments or applying pre-defined rules to filter objects
based on their attributes.</p>









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="nickyspatial.filters.spatial"></a>
    <div class="doc doc-contents first">

        <p>Implements spatial operations like smoothing and morphological transformations.</p>
<p>These filters can modify the geometry or arrangement of pixel values to enhance or simplify data for object analysis.
The functions here include smoothing boundaries, merging small segments, and selecting segments based on area.
These operations are essential for preparing data for object-based image analysis, especially in remote sensing applications.
The functions are designed to work with raster data and can be applied to layers created from segmentation algorithms.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="nickyspatial.filters.spatial.merge_small_segments" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_small_segments</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">min_size</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="s1">&#39;area_pixels&#39;</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.filters.spatial.merge_small_segments" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Merge small segments with their largest neighbor.</p>
<h4 id="nickyspatial.filters.spatial.merge_small_segments--parameters">Parameters:<a class="headerlink" href="#nickyspatial.filters.spatial.merge_small_segments--parameters" title="Permanent link">&para;</a></h4>
<p>source_layer : Layer
    Source layer with segments to merge
min_size : float
    Minimum segment size threshold
attribute : str
    Attribute to use for size comparison
layer_manager : LayerManager, optional
    Layer manager to add the result layer to
layer_name : str, optional
    Name for the result layer</p>
<h4 id="nickyspatial.filters.spatial.merge_small_segments--returns">Returns:<a class="headerlink" href="#nickyspatial.filters.spatial.merge_small_segments--returns" title="Permanent link">&para;</a></h4>
<p>result_layer : Layer
    Layer with merged segments</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/filters/spatial.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="k">def</span><span class="w"> </span><span class="nf">merge_small_segments</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">min_size</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="s2">&quot;area_pixels&quot;</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge small segments with their largest neighbor.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    source_layer : Layer</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        Source layer with segments to merge</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    min_size : float</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        Minimum segment size threshold</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    attribute : str</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        Attribute to use for size comparison</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    layer_manager : LayerManager, optional</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        Layer manager to add the result layer to</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    layer_name : str, optional</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        Name for the result layer</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    --------</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    result_layer : Layer</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        Layer with merged segments</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_name</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="n">layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source_layer</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_merged&quot;</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="n">result_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source_layer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;filter&quot;</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="s2">&quot;filter_type&quot;</span><span class="p">:</span> <span class="s2">&quot;merge_small_segments&quot;</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="s2">&quot;min_size&quot;</span><span class="p">:</span> <span class="n">min_size</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="n">attribute</span><span class="p">,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="p">}</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="n">objects</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="n">small_segments</span> <span class="o">=</span> <span class="n">objects</span><span class="p">[</span><span class="n">objects</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_size</span><span class="p">]</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">small_segments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">objects</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="k">return</span> <span class="n">result_layer</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">small_segment</span> <span class="ow">in</span> <span class="n">small_segments</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="k">if</span> <span class="n">idx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">objects</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="k">continue</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">neighbors</span> <span class="o">=</span> <span class="n">objects</span><span class="p">[</span><span class="n">objects</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">small_segment</span><span class="o">.</span><span class="n">geometry</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">objects</span><span class="o">.</span><span class="n">crs</span><span class="p">),</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;intersection&quot;</span><span class="p">,</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="k">continue</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">largest_neighbor_idx</span> <span class="o">=</span> <span class="n">neighbors</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">largest_neighbor</span> <span class="o">=</span> <span class="n">objects</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">largest_neighbor_idx</span><span class="p">]</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="n">merged_geometry</span> <span class="o">=</span> <span class="n">largest_neighbor</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">small_segment</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">objects</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">largest_neighbor_idx</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_geometry</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">objects</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">largest_neighbor_idx</span><span class="p">,</span> <span class="n">attribute</span><span class="p">]</span> <span class="o">+=</span> <span class="n">small_segment</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">objects</span> <span class="o">=</span> <span class="n">objects</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">segments_raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">old_to_new</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="k">for</span> <span class="n">_idx</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">old_id</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="n">old_to_new</span><span class="p">[</span><span class="n">old_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_id</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">small_segment</span> <span class="ow">in</span> <span class="n">small_segments</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="k">if</span> <span class="n">idx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">objects</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                <span class="n">old_id</span> <span class="o">=</span> <span class="n">small_segment</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>                <span class="n">touching_segments</span> <span class="o">=</span> <span class="n">objects</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">small_segment</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">touching_segments</span><span class="p">):</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                    <span class="n">new_id</span> <span class="o">=</span> <span class="n">objects</span><span class="p">[</span><span class="n">touching_segments</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                    <span class="n">old_to_new</span><span class="p">[</span><span class="n">old_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_id</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="k">for</span> <span class="n">old_id</span><span class="p">,</span> <span class="n">new_id</span> <span class="ow">in</span> <span class="n">old_to_new</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="k">if</span> <span class="n">old_id</span> <span class="o">!=</span> <span class="n">new_id</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="n">segments_raster</span><span class="p">[</span><span class="n">segments_raster</span> <span class="o">==</span> <span class="n">old_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_id</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">segments_raster</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">objects</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="k">return</span> <span class="n">result_layer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.filters.spatial.select_by_area" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">select_by_area</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">min_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">area_column</span><span class="o">=</span><span class="s1">&#39;area_units&#39;</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.filters.spatial.select_by_area" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Select segments based on area.</p>
<h4 id="nickyspatial.filters.spatial.select_by_area--parameters">Parameters:<a class="headerlink" href="#nickyspatial.filters.spatial.select_by_area--parameters" title="Permanent link">&para;</a></h4>
<p>source_layer : Layer
    Source layer with segments to filter
min_area : float, optional
    Minimum area threshold
max_area : float, optional
    Maximum area threshold
area_column : str
    Column containing area values
layer_manager : LayerManager, optional
    Layer manager to add the result layer to
layer_name : str, optional
    Name for the result layer</p>
<h4 id="nickyspatial.filters.spatial.select_by_area--returns">Returns:<a class="headerlink" href="#nickyspatial.filters.spatial.select_by_area--returns" title="Permanent link">&para;</a></h4>
<p>result_layer : Layer
    Layer with filtered segments</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/filters/spatial.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="k">def</span><span class="w"> </span><span class="nf">select_by_area</span><span class="p">(</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="n">source_layer</span><span class="p">,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="n">min_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="n">max_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="n">area_column</span><span class="o">=</span><span class="s2">&quot;area_units&quot;</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="p">):</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Select segments based on area.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    source_layer : Layer</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        Source layer with segments to filter</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    min_area : float, optional</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        Minimum area threshold</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    max_area : float, optional</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">        Maximum area threshold</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    area_column : str</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        Column containing area values</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">    layer_manager : LayerManager, optional</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">        Layer manager to add the result layer to</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    layer_name : str, optional</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        Name for the result layer</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    --------</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">    result_layer : Layer</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        Layer with filtered segments</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_name</span><span class="p">:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="n">layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source_layer</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_area_filtered&quot;</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="n">result_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source_layer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;filter&quot;</span><span class="p">)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="s2">&quot;filter_type&quot;</span><span class="p">:</span> <span class="s2">&quot;select_by_area&quot;</span><span class="p">,</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="s2">&quot;min_area&quot;</span><span class="p">:</span> <span class="n">min_area</span><span class="p">,</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="s2">&quot;max_area&quot;</span><span class="p">:</span> <span class="n">max_area</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="s2">&quot;area_column&quot;</span><span class="p">:</span> <span class="n">area_column</span><span class="p">,</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="p">}</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="n">objects</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="k">if</span> <span class="n">min_area</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="n">objects</span> <span class="o">=</span> <span class="n">objects</span><span class="p">[</span><span class="n">objects</span><span class="p">[</span><span class="n">area_column</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_area</span><span class="p">]</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="k">if</span> <span class="n">max_area</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="n">objects</span> <span class="o">=</span> <span class="n">objects</span><span class="p">[</span><span class="n">objects</span><span class="p">[</span><span class="n">area_column</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max_area</span><span class="p">]</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">objects</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="n">kept_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">])</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="n">segments_raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">segments_raster</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">kept_ids</span><span class="p">))</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="n">segments_raster</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">segments_raster</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="k">return</span> <span class="n">result_layer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.filters.spatial.smooth_boundaries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">smooth_boundaries</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.filters.spatial.smooth_boundaries" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Smooth segment boundaries by applying morphological operations.</p>
<h4 id="nickyspatial.filters.spatial.smooth_boundaries--parameters">Parameters:<a class="headerlink" href="#nickyspatial.filters.spatial.smooth_boundaries--parameters" title="Permanent link">&para;</a></h4>
<p>source_layer : Layer
    Source layer with segments to smooth
iterations : int
    Number of smoothing iterations to apply
layer_manager : LayerManager, optional
    Layer manager to add the result layer to
layer_name : str, optional
    Name for the result layer</p>
<h4 id="nickyspatial.filters.spatial.smooth_boundaries--returns">Returns:<a class="headerlink" href="#nickyspatial.filters.spatial.smooth_boundaries--returns" title="Permanent link">&para;</a></h4>
<p>result_layer : Layer
    Layer with smoothed segment boundaries</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/filters/spatial.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">smooth_boundaries</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Smooth segment boundaries by applying morphological operations.</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    source_layer : Layer</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">        Source layer with segments to smooth</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    iterations : int</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        Number of smoothing iterations to apply</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    layer_manager : LayerManager, optional</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        Layer manager to add the result layer to</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    layer_name : str, optional</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        Name for the result layer</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    --------</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    result_layer : Layer</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        Layer with smoothed segment boundaries</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_name</span><span class="p">:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="n">layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source_layer</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_smoothed&quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">result_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source_layer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;filter&quot;</span><span class="p">)</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="s2">&quot;filter_type&quot;</span><span class="p">:</span> <span class="s2">&quot;smooth_boundaries&quot;</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="s2">&quot;iterations&quot;</span><span class="p">:</span> <span class="n">iterations</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="p">}</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">objects</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="n">smoothed_geometries</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">objects</span><span class="o">.</span><span class="n">geometry</span><span class="p">:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="n">smoothed_geom</span> <span class="o">=</span> <span class="n">geom</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>            <span class="n">buffer_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">smoothed_geom</span><span class="o">.</span><span class="n">area</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="n">smoothed_geom</span> <span class="o">=</span> <span class="n">smoothed_geom</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="o">-</span><span class="n">buffer_distance</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_distance</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">smoothed_geom</span><span class="o">.</span><span class="n">is_valid</span><span class="p">:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>            <span class="n">smoothed_geom</span> <span class="o">=</span> <span class="n">smoothed_geom</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">smoothed_geometries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">smoothed_geom</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">objects</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">smoothed_geometries</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">objects</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">return</span> <span class="n">result_layer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="nickyspatial.filters.spectral"></a>
    <div class="doc doc-contents first">

        <p>Performs spectral-based manipulations of imagery, including band arithmetic and transformations.</p>
<p>It supports generating new spectral bands or combinations to highlight specific features.
It also includes functions for enhancing contrast and applying spectral filters based on mathematical expressions.
This module is designed to work with raster .
The functions here include contrast enhancement, spectral filtering, and band arithmetic.
Not a great fan of these but might be handy sometime</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="nickyspatial.filters.spectral.enhance_contrast" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">enhance_contrast</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">percentile_min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">percentile_max</span><span class="o">=</span><span class="mi">98</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.filters.spectral.enhance_contrast" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Enhance contrast in source layer raster data.</p>
<h4 id="nickyspatial.filters.spectral.enhance_contrast--parameters">Parameters:<a class="headerlink" href="#nickyspatial.filters.spectral.enhance_contrast--parameters" title="Permanent link">&para;</a></h4>
<p>source_layer : Layer
    Source layer with raster data
percentile_min : float
    Lower percentile for contrast stretching
percentile_max : float
    Upper percentile for contrast stretching
layer_manager : LayerManager, optional
    Layer manager to add the result layer to
layer_name : str, optional
    Name for the result layer</p>
<h4 id="nickyspatial.filters.spectral.enhance_contrast--returns">Returns:<a class="headerlink" href="#nickyspatial.filters.spectral.enhance_contrast--returns" title="Permanent link">&para;</a></h4>
<p>result_layer : Layer
    Layer with enhanced contrast</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/filters/spectral.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">enhance_contrast</span><span class="p">(</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="n">source_layer</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="n">percentile_min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="n">percentile_max</span><span class="o">=</span><span class="mi">98</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="p">):</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Enhance contrast in source layer raster data.</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    source_layer : Layer</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        Source layer with raster data</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    percentile_min : float</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        Lower percentile for contrast stretching</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    percentile_max : float</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        Upper percentile for contrast stretching</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    layer_manager : LayerManager, optional</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        Layer manager to add the result layer to</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    layer_name : str, optional</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        Name for the result layer</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    --------</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    result_layer : Layer</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        Layer with enhanced contrast</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Source layer must have raster data&quot;</span><span class="p">)</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_name</span><span class="p">:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="n">layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source_layer</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_enhanced&quot;</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="n">result_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source_layer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;filter&quot;</span><span class="p">)</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="s2">&quot;filter_type&quot;</span><span class="p">:</span> <span class="s2">&quot;enhance_contrast&quot;</span><span class="p">,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="s2">&quot;percentile_min&quot;</span><span class="p">:</span> <span class="n">percentile_min</span><span class="p">,</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="s2">&quot;percentile_max&quot;</span><span class="p">:</span> <span class="n">percentile_max</span><span class="p">,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="p">}</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">enhanced_raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">p_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">enhanced_raster</span><span class="p">,</span> <span class="n">percentile_min</span><span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">p_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">enhanced_raster</span><span class="p">,</span> <span class="n">percentile_max</span><span class="p">)</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">enhanced_raster</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">enhanced_raster</span><span class="p">,</span> <span class="n">p_min</span><span class="p">,</span> <span class="n">p_max</span><span class="p">)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">enhanced_raster</span> <span class="o">=</span> <span class="p">(</span><span class="n">enhanced_raster</span> <span class="o">-</span> <span class="n">p_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_max</span> <span class="o">-</span> <span class="n">p_min</span><span class="p">)</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">enhanced_raster</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="k">return</span> <span class="n">result_layer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.filters.spectral.spectral_filter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">spectral_filter</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.filters.spectral.spectral_filter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Apply a spectral filter based on a mathematical expression.</p>
<h4 id="nickyspatial.filters.spectral.spectral_filter--parameters">Parameters:<a class="headerlink" href="#nickyspatial.filters.spectral.spectral_filter--parameters" title="Permanent link">&para;</a></h4>
<p>source_layer : Layer
    Source layer with segment statistics
expression : str
    Mathematical expression to apply (e.g., "NDVI &gt; 0.5")
layer_manager : LayerManager, optional
    Layer manager to add the result layer to
layer_name : str, optional
    Name for the result layer</p>
<h4 id="nickyspatial.filters.spectral.spectral_filter--returns">Returns:<a class="headerlink" href="#nickyspatial.filters.spectral.spectral_filter--returns" title="Permanent link">&para;</a></h4>
<p>result_layer : Layer
    Layer with filtered segments</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/filters/spectral.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="k">def</span><span class="w"> </span><span class="nf">spectral_filter</span><span class="p">(</span><span class="n">source_layer</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">layer_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply a spectral filter based on a mathematical expression.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    source_layer : Layer</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        Source layer with segment statistics</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    expression : str</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        Mathematical expression to apply (e.g., &quot;NDVI &gt; 0.5&quot;)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    layer_manager : LayerManager, optional</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        Layer manager to add the result layer to</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    layer_name : str, optional</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        Name for the result layer</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    --------</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    result_layer : Layer</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        Layer with filtered segments</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">numexpr</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ne</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_name</span><span class="p">:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="n">layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source_layer</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_spectral_filtered&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">result_layer</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">source_layer</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;filter&quot;</span><span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="n">result_layer</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;filter_type&quot;</span><span class="p">:</span> <span class="s2">&quot;spectral_filter&quot;</span><span class="p">,</span> <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="n">expression</span><span class="p">}</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="n">objects</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">local_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">objects</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">objects</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;geometry&quot;</span><span class="p">}</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">ne</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">local_dict</span><span class="o">=</span><span class="n">local_dict</span><span class="p">)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">filtered_objects</span> <span class="o">=</span> <span class="n">objects</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">result_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">filtered_objects</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="k">if</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="n">kept_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">filtered_objects</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">])</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="n">segments_raster</span> <span class="o">=</span> <span class="n">source_layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="n">raster_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">segments_raster</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">kept_ids</span><span class="p">))</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">segments_raster</span><span class="p">[</span><span class="o">~</span><span class="n">raster_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="n">result_layer</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">segments_raster</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error applying spectral filter: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="k">if</span> <span class="n">layer_manager</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">layer_manager</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">result_layer</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="k">return</span> <span class="n">result_layer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="nickyspatialio"><code>nickyspatial.io</code><a class="headerlink" href="#nickyspatialio" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<a id="nickyspatial.io"></a>
    <div class="doc doc-contents first">

        <p>The io package contains modules for reading and writing both raster and vector data.</p>
<p>It abstracts file operations and coordinate system handling to facilitate I/O tasks.</p>









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="nickyspatial.io.raster"></a>
    <div class="doc doc-contents first">

        <p>Handles raster input and output operations, including reading and saving multi-band images.</p>
<p>Functions in this module may also provide metadata parsing and coordinate transform tools.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="nickyspatial.io.raster.layer_to_raster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">layer_to_raster</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

<a href="#nickyspatial.io.raster.layer_to_raster" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Save a layer to a raster file.</p>
<h4 id="nickyspatial.io.raster.layer_to_raster--parameters">Parameters:<a class="headerlink" href="#nickyspatial.io.raster.layer_to_raster--parameters" title="Permanent link">&para;</a></h4>
<p>layer : Layer
    Layer to save
output_path : str
    Path to the output raster file
column : str, optional
    Column to rasterize (if saving from vector objects)
nodata : int or float, optional
    No data value</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/io/raster.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="nf">layer_to_raster</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Save a layer to a raster file.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        Layer to save</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    output_path : str</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        Path to the output raster file</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    column : str, optional</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        Column to rasterize (if saving from vector objects)</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    nodata : int or float, optional</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        No data value</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">rasterio</span><span class="w"> </span><span class="kn">import</span> <span class="n">features</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">column</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">write_raster</span><span class="p">(</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="n">output_path</span><span class="p">,</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">layer</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="n">layer</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">nodata</span><span class="p">,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">return</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">column</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&#39; not found in layer objects&quot;</span><span class="p">)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="n">objects</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">col_values</span> <span class="o">=</span> <span class="n">objects</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="c1"># Check if values are numeric</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">col_values</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="n">shapes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">geom</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">))</span> <span class="k">for</span> <span class="n">geom</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">objects</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">col_values</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="n">unique_vals</span> <span class="o">=</span> <span class="n">col_values</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="n">val_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">val</span><span class="p">:</span> <span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">)}</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mapping categorical values: </span><span class="si">{</span><span class="n">val_map</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="n">shapes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">geom</span><span class="p">,</span> <span class="n">val_map</span><span class="p">[</span><span class="n">val</span><span class="p">])</span> <span class="k">for</span> <span class="n">geom</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">objects</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">col_values</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>                <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>                <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="n">out_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="n">bounds</span> <span class="o">=</span> <span class="n">objects</span><span class="o">.</span><span class="n">total_bounds</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="n">resolution</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">transform</span><span class="p">:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>                <span class="n">resolution</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">resolution</span><span class="p">)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">resolution</span><span class="p">)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">out_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">transform</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                <span class="n">layer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">from_origin</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">out_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="n">nodata</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">features</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">layer</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">nodata</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">write_raster</span><span class="p">(</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="n">output_path</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="n">output</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">out_shape</span><span class="p">),</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">layer</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="n">layer</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="n">nodata</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Layer must have either raster data or objects with a specified column&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.io.raster.read_raster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_raster</span><span class="p">(</span><span class="n">raster_path</span><span class="p">)</span></code>

<a href="#nickyspatial.io.raster.read_raster" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Read a raster file and return its data, transform, and CRS.</p>
<h4 id="nickyspatial.io.raster.read_raster--parameters">Parameters:<a class="headerlink" href="#nickyspatial.io.raster.read_raster--parameters" title="Permanent link">&para;</a></h4>
<p>raster_path : str
    Path to the raster file</p>
<h4 id="nickyspatial.io.raster.read_raster--returns">Returns:<a class="headerlink" href="#nickyspatial.io.raster.read_raster--returns" title="Permanent link">&para;</a></h4>
<p>image_data : numpy.ndarray
    Array with raster data values
transform : affine.Affine
    Affine transformation for the raster
crs : rasterio.crs.CRS
    Coordinate reference system</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/io/raster.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="k">def</span><span class="w"> </span><span class="nf">read_raster</span><span class="p">(</span><span class="n">raster_path</span><span class="p">):</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Read a raster file and return its data, transform, and CRS.</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    raster_path : str</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">        Path to the raster file</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    --------</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    image_data : numpy.ndarray</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        Array with raster data values</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    transform : affine.Affine</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        Affine transformation for the raster</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    crs : rasterio.crs.CRS</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        Coordinate reference system</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">raster_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="n">image_data</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="n">transform</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">transform</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="n">crs</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="k">return</span> <span class="n">image_data</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">crs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.io.raster.write_raster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_raster</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.io.raster.write_raster" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Write raster data to a file.</p>
<h4 id="nickyspatial.io.raster.write_raster--parameters">Parameters:<a class="headerlink" href="#nickyspatial.io.raster.write_raster--parameters" title="Permanent link">&para;</a></h4>
<p>output_path : str
    Path to the output raster file
data : numpy.ndarray
    Array with raster data values
transform : affine.Affine
    Affine transformation for the raster
crs : rasterio.crs.CRS
    Coordinate reference system
nodata : int or float, optional
    No data value</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/io/raster.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="k">def</span><span class="w"> </span><span class="nf">write_raster</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Write raster data to a file.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    output_path : str</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        Path to the output raster file</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    data : numpy.ndarray</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        Array with raster data values</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    transform : affine.Affine</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        Affine transformation for the raster</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    crs : rasterio.crs.CRS</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        Coordinate reference system</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    nodata : int or float, optional</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        No data value</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">count</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="n">output_path</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="s2">&quot;w&quot;</span><span class="p">,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="n">dtype</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">nodata</span><span class="o">=</span><span class="n">nodata</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="nickyspatial.io.vector"></a>
    <div class="doc doc-contents first">

        <p>Manages vector data I/O, supporting formats like Shapefile and GeoJSON.</p>
<p>This module typically offers utilities for handling attributes, geometries, and coordinate reference systems.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="nickyspatial.io.vector.layer_to_vector" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">layer_to_vector</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span></code>

<a href="#nickyspatial.io.vector.layer_to_vector" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Save a layer's objects to a vector file.</p>
<h4 id="nickyspatial.io.vector.layer_to_vector--parameters">Parameters:<a class="headerlink" href="#nickyspatial.io.vector.layer_to_vector--parameters" title="Permanent link">&para;</a></h4>
<p>layer : Layer
    Layer to save
output_path : str
    Path to the output vector file</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/io/vector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="k">def</span><span class="w"> </span><span class="nf">layer_to_vector</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">output_path</span><span class="p">):</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Save a layer&#39;s objects to a vector file.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        Layer to save</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    output_path : str</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        Path to the output vector file</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Layer has no vector objects&quot;</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">write_vector</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.io.vector.read_vector" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_vector</span><span class="p">(</span><span class="n">vector_path</span><span class="p">)</span></code>

<a href="#nickyspatial.io.vector.read_vector" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Read a vector file into a GeoDataFrame.</p>
<h4 id="nickyspatial.io.vector.read_vector--parameters">Parameters:<a class="headerlink" href="#nickyspatial.io.vector.read_vector--parameters" title="Permanent link">&para;</a></h4>
<p>vector_path : str
    Path to the vector file</p>
<h4 id="nickyspatial.io.vector.read_vector--returns">Returns:<a class="headerlink" href="#nickyspatial.io.vector.read_vector--returns" title="Permanent link">&para;</a></h4>
<p>gdf : geopandas.GeoDataFrame
    GeoDataFrame with vector data</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/io/vector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="k">def</span><span class="w"> </span><span class="nf">read_vector</span><span class="p">(</span><span class="n">vector_path</span><span class="p">):</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Read a vector file into a GeoDataFrame.</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    vector_path : str</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        Path to the vector file</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    --------</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    gdf : geopandas.GeoDataFrame</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        GeoDataFrame with vector data</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">vector_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.io.vector.write_vector" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_vector</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span></code>

<a href="#nickyspatial.io.vector.write_vector" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Write a GeoDataFrame to a vector file.</p>
<h4 id="nickyspatial.io.vector.write_vector--parameters">Parameters:<a class="headerlink" href="#nickyspatial.io.vector.write_vector--parameters" title="Permanent link">&para;</a></h4>
<p>gdf : geopandas.GeoDataFrame
    GeoDataFrame to write
output_path : str
    Path to the output vector file</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/io/vector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="k">def</span><span class="w"> </span><span class="nf">write_vector</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">output_path</span><span class="p">):</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Write a GeoDataFrame to a vector file.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    gdf : geopandas.GeoDataFrame</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        GeoDataFrame to write</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    output_path : str</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        Path to the output vector file</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">output_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="k">if</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s2">&quot;.shp&quot;</span><span class="p">:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="n">gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s2">&quot;.geojson&quot;</span><span class="p">:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="n">gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported vector format: </span><span class="si">{</span><span class="n">file_extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="nickyspatialstats"><code>nickyspatial.stats</code><a class="headerlink" href="#nickyspatialstats" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<a id="nickyspatial.stats"></a>
    <div class="doc doc-contents first">

        <p>The stats package includes modules for calculating statistical metrics on objects.</p>
<p>This is to mimic the stats module in ecognition because they will be necessary in order to apply rules later on and extremely
essential to work with objects</p>









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="nickyspatial.stats.basic"></a>
    <div class="doc doc-contents first">

        <p>Basic statistics for layers in NickySpatial.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="nickyspatial.stats.basic.attach_basic_stats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attach_basic_stats</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.stats.basic.attach_basic_stats" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Attach basic statistics for a column to a layer.</p>
<h4 id="nickyspatial.stats.basic.attach_basic_stats--parameters">Parameters:<a class="headerlink" href="#nickyspatial.stats.basic.attach_basic_stats--parameters" title="Permanent link">&para;</a></h4>
<p>layer : Layer
    Layer to attach statistics to
column : str
    Column to calculate statistics for
prefix : str, optional
    Prefix for result names</p>
<h4 id="nickyspatial.stats.basic.attach_basic_stats--returns">Returns:<a class="headerlink" href="#nickyspatial.stats.basic.attach_basic_stats--returns" title="Permanent link">&para;</a></h4>
<p>stats : dict
    Dictionary with calculated statistics</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/stats/basic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">attach_basic_stats</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Attach basic statistics for a column to a layer.</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">        Layer to attach statistics to</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    column : str</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">        Column to calculate statistics for</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    prefix : str, optional</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">        Prefix for result names</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    --------</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    stats : dict</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">        Dictionary with calculated statistics</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&#39; not found in layer objects&quot;</span><span class="p">)</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="k">if</span> <span class="n">prefix</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">values</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">min&quot;</span><span class="p">:</span> <span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">max&quot;</span><span class="p">:</span> <span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">mean&quot;</span><span class="p">:</span> <span class="n">values</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">median&quot;</span><span class="p">:</span> <span class="n">values</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">std&quot;</span><span class="p">:</span> <span class="n">values</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">sum&quot;</span><span class="p">:</span> <span class="n">values</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="p">}</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">percentiles</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">percentiles</span><span class="p">:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="n">stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">percentile_</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="k">return</span> <span class="n">stats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.stats.basic.attach_class_distribution" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attach_class_distribution</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">class_column</span><span class="o">=</span><span class="s1">&#39;classification&#39;</span><span class="p">)</span></code>

<a href="#nickyspatial.stats.basic.attach_class_distribution" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate the distribution of classes in a layer.</p>
<h4 id="nickyspatial.stats.basic.attach_class_distribution--parameters">Parameters:<a class="headerlink" href="#nickyspatial.stats.basic.attach_class_distribution--parameters" title="Permanent link">&para;</a></h4>
<p>layer : Layer
    Layer to analyze
class_column : str
    Column containing class values</p>
<h4 id="nickyspatial.stats.basic.attach_class_distribution--returns">Returns:<a class="headerlink" href="#nickyspatial.stats.basic.attach_class_distribution--returns" title="Permanent link">&para;</a></h4>
<p>distribution : dict
    Dictionary with class counts and percentages</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/stats/basic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="k">def</span><span class="w"> </span><span class="nf">attach_class_distribution</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">class_column</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">):</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the distribution of classes in a layer.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        Layer to analyze</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    class_column : str</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        Column containing class values</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    --------</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    distribution : dict</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        Dictionary with class counts and percentages</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">class_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="n">class_counts</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">class_column</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="n">total_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="n">class_percentages</span> <span class="o">=</span> <span class="p">(</span><span class="n">class_counts</span> <span class="o">/</span> <span class="n">total_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">distribution</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="s2">&quot;counts&quot;</span><span class="p">:</span> <span class="n">class_counts</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="s2">&quot;percentages&quot;</span><span class="p">:</span> <span class="n">class_percentages</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="n">total_count</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="p">}</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="k">return</span> <span class="n">distribution</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.stats.basic.attach_count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attach_count</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">class_column</span><span class="o">=</span><span class="s1">&#39;classification&#39;</span><span class="p">,</span> <span class="n">class_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.stats.basic.attach_count" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Count objects in a layer, optionally filtered by class.</p>
<h4 id="nickyspatial.stats.basic.attach_count--parameters">Parameters:<a class="headerlink" href="#nickyspatial.stats.basic.attach_count--parameters" title="Permanent link">&para;</a></h4>
<p>layer : Layer
    Layer to count objects in
class_column : str
    Column containing class values
class_value : str, optional
    Class value to filter by</p>
<h4 id="nickyspatial.stats.basic.attach_count--returns">Returns:<a class="headerlink" href="#nickyspatial.stats.basic.attach_count--returns" title="Permanent link">&para;</a></h4>
<p>count : int
    Number of objects</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/stats/basic.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="k">def</span><span class="w"> </span><span class="nf">attach_count</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">class_column</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span> <span class="n">class_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Count objects in a layer, optionally filtered by class.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        Layer to count objects in</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    class_column : str</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        Column containing class values</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    class_value : str, optional</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        Class value to filter by</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    --------</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    count : int</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        Number of objects</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="k">return</span> <span class="mi">0</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="k">if</span> <span class="n">class_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">class_column</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">count</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">class_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">class_value</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="n">count</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="k">return</span> <span class="n">count</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="nickyspatial.stats.spatial"></a>
    <div class="doc doc-contents first">

        <p>Spatial statistics for layers in NickySpatial.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="nickyspatial.stats.spatial.attach_area_stats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attach_area_stats</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">area_column</span><span class="o">=</span><span class="s1">&#39;area_units&#39;</span><span class="p">,</span> <span class="n">by_class</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.stats.spatial.attach_area_stats" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate area statistics for objects in a layer.</p>
<h4 id="nickyspatial.stats.spatial.attach_area_stats--parameters">Parameters:<a class="headerlink" href="#nickyspatial.stats.spatial.attach_area_stats--parameters" title="Permanent link">&para;</a></h4>
<p>layer : Layer
    Layer to calculate statistics for
area_column : str
    Column containing area values
by_class : str, optional
    Column to group by (e.g., 'classification')</p>
<h4 id="nickyspatial.stats.spatial.attach_area_stats--returns">Returns:<a class="headerlink" href="#nickyspatial.stats.spatial.attach_area_stats--returns" title="Permanent link">&para;</a></h4>
<p>stats : dict
    Dictionary with area statistics</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/stats/spatial.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">attach_area_stats</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">area_column</span><span class="o">=</span><span class="s2">&quot;area_units&quot;</span><span class="p">,</span> <span class="n">by_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate area statistics for objects in a layer.</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">        Layer to calculate statistics for</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    area_column : str</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">        Column containing area values</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    by_class : str, optional</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">        Column to group by (e.g., &#39;classification&#39;)</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    --------</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    stats : dict</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">        Dictionary with area statistics</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">area_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">total_area</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">area_column</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="k">if</span> <span class="n">by_class</span> <span class="ow">and</span> <span class="n">by_class</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>        <span class="n">class_areas</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="n">class_percentages</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="k">for</span> <span class="n">class_value</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by_class</span><span class="p">):</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>            <span class="k">if</span> <span class="n">class_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>                <span class="k">continue</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>            <span class="n">class_area</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">area_column</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>            <span class="n">class_percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">class_area</span> <span class="o">/</span> <span class="n">total_area</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>            <span class="n">class_areas</span><span class="p">[</span><span class="n">class_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">class_area</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>            <span class="n">class_percentages</span><span class="p">[</span><span class="n">class_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">class_percentage</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="s2">&quot;total_area&quot;</span><span class="p">:</span> <span class="n">total_area</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="s2">&quot;class_areas&quot;</span><span class="p">:</span> <span class="n">class_areas</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="s2">&quot;class_percentages&quot;</span><span class="p">:</span> <span class="n">class_percentages</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="p">}</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="n">areas</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">area_column</span><span class="p">]</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="s2">&quot;total_area&quot;</span><span class="p">:</span> <span class="n">total_area</span><span class="p">,</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="s2">&quot;min_area&quot;</span><span class="p">:</span> <span class="n">areas</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>            <span class="s2">&quot;max_area&quot;</span><span class="p">:</span> <span class="n">areas</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="s2">&quot;mean_area&quot;</span><span class="p">:</span> <span class="n">areas</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>            <span class="s2">&quot;median_area&quot;</span><span class="p">:</span> <span class="n">areas</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>            <span class="s2">&quot;std_area&quot;</span><span class="p">:</span> <span class="n">areas</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="p">}</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="k">return</span> <span class="n">stats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.stats.spatial.attach_neighbor_stats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attach_neighbor_stats</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span></code>

<a href="#nickyspatial.stats.spatial.attach_neighbor_stats" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate neighborhood statistics for objects in a layer.</p>
<h4 id="nickyspatial.stats.spatial.attach_neighbor_stats--parameters">Parameters:<a class="headerlink" href="#nickyspatial.stats.spatial.attach_neighbor_stats--parameters" title="Permanent link">&para;</a></h4>
<p>layer : Layer
    Layer to calculate statistics for</p>
<h4 id="nickyspatial.stats.spatial.attach_neighbor_stats--returns">Returns:<a class="headerlink" href="#nickyspatial.stats.spatial.attach_neighbor_stats--returns" title="Permanent link">&para;</a></h4>
<p>stats : dict
    Dictionary with neighborhood statistics</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/stats/spatial.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="k">def</span><span class="w"> </span><span class="nf">attach_neighbor_stats</span><span class="p">(</span><span class="n">layer</span><span class="p">):</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate neighborhood statistics for objects in a layer.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        Layer to calculate statistics for</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    --------</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    stats : dict</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        Dictionary with neighborhood statistics</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">neighbors</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="n">neighbor_counts</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="n">touching</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">neighbor_ids</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">touching</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">neighbors</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">neighbor_ids</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="n">neighbor_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">neighbor_ids</span><span class="p">))</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;neighbor_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">neighbor_counts</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="s2">&quot;neighbor_count&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">neighbor_counts</span><span class="p">),</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">neighbor_counts</span><span class="p">),</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">neighbor_counts</span><span class="p">),</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">neighbor_counts</span><span class="p">),</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="p">}</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="p">}</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="k">return</span> <span class="n">stats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.stats.spatial.attach_shape_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attach_shape_metrics</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span></code>

<a href="#nickyspatial.stats.spatial.attach_shape_metrics" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate shape metrics for objects in a layer.</p>
<h4 id="nickyspatial.stats.spatial.attach_shape_metrics--parameters">Parameters:<a class="headerlink" href="#nickyspatial.stats.spatial.attach_shape_metrics--parameters" title="Permanent link">&para;</a></h4>
<p>layer : Layer
    Layer to calculate metrics for</p>
<h4 id="nickyspatial.stats.spatial.attach_shape_metrics--returns">Returns:<a class="headerlink" href="#nickyspatial.stats.spatial.attach_shape_metrics--returns" title="Permanent link">&para;</a></h4>
<p>metrics : dict
    Dictionary with shape metrics</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/stats/spatial.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="k">def</span><span class="w"> </span><span class="nf">attach_shape_metrics</span><span class="p">(</span><span class="n">layer</span><span class="p">):</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate shape metrics for objects in a layer.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        Layer to calculate metrics for</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    --------</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    metrics : dict</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        Dictionary with shape metrics</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">length</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="k">if</span> <span class="s2">&quot;area_units&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;area_units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">area</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;shape_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;area_units&quot;</span><span class="p">])))</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="p">)</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;compactness&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;area_units&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="s2">&quot;shape_index&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;shape_index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;shape_index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;shape_index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;shape_index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="p">},</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="s2">&quot;compactness&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;compactness&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;compactness&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;compactness&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;compactness&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="p">},</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="p">}</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="k">return</span> <span class="n">metrics</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="nickyspatial.stats.spectral"></a>
    <div class="doc doc-contents first">

        <p>Spectral indices calculation module.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="nickyspatial.stats.spectral.attach_ndvi" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attach_ndvi</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">nir_column</span><span class="o">=</span><span class="s1">&#39;NIR_mean&#39;</span><span class="p">,</span> <span class="n">red_column</span><span class="o">=</span><span class="s1">&#39;Red_mean&#39;</span><span class="p">,</span> <span class="n">output_column</span><span class="o">=</span><span class="s1">&#39;NDVI&#39;</span><span class="p">)</span></code>

<a href="#nickyspatial.stats.spectral.attach_ndvi" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate NDVI (Normalized Difference Vegetation Index) for objects in a layer.</p>
<h4 id="nickyspatial.stats.spectral.attach_ndvi--parameters">Parameters:<a class="headerlink" href="#nickyspatial.stats.spectral.attach_ndvi--parameters" title="Permanent link">&para;</a></h4>
<p>layer : Layer
    Layer to calculate NDVI for
nir_column : str
    Column containing NIR band values
red_column : str
    Column containing Red band values
output_column : str
    Column to store NDVI values</p>
<h4 id="nickyspatial.stats.spectral.attach_ndvi--returns">Returns:<a class="headerlink" href="#nickyspatial.stats.spectral.attach_ndvi--returns" title="Permanent link">&para;</a></h4>
<p>ndvi_stats : dict
    Dictionary with NDVI statistics</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/stats/spectral.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">attach_ndvi</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">nir_column</span><span class="o">=</span><span class="s2">&quot;NIR_mean&quot;</span><span class="p">,</span> <span class="n">red_column</span><span class="o">=</span><span class="s2">&quot;Red_mean&quot;</span><span class="p">,</span> <span class="n">output_column</span><span class="o">=</span><span class="s2">&quot;NDVI&quot;</span><span class="p">):</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate NDVI (Normalized Difference Vegetation Index) for objects in a layer.</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">        Layer to calculate NDVI for</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    nir_column : str</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">        Column containing NIR band values</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    red_column : str</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">        Column containing Red band values</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    output_column : str</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">        Column to store NDVI values</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    --------</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    ndvi_stats : dict</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        Dictionary with NDVI statistics</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">nir_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="n">red_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">nir</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">nir_column</span><span class="p">]</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="n">red</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">red_column</span><span class="p">]</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">denominator</span> <span class="o">=</span> <span class="n">nir</span> <span class="o">+</span> <span class="n">red</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">denominator</span> <span class="o">!=</span> <span class="mi">0</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">ndvi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">))</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">ndvi</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">nir</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">red</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">output_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">ndvi</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">ndvi_stats</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">ndvi</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">ndvi</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">ndvi</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ndvi</span><span class="p">),</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="s2">&quot;median&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">ndvi</span><span class="p">),</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="p">}</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="k">return</span> <span class="n">ndvi_stats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.stats.spectral.attach_spectral_indices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attach_spectral_indices</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.stats.spectral.attach_spectral_indices" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate multiple spectral indices for objects in a layer.</p>
<h4 id="nickyspatial.stats.spectral.attach_spectral_indices--parameters">Parameters:<a class="headerlink" href="#nickyspatial.stats.spectral.attach_spectral_indices--parameters" title="Permanent link">&para;</a></h4>
<p>layer : Layer
    Layer to calculate indices for
bands : dict, optional
    Dictionary mapping band names to column names</p>
<h4 id="nickyspatial.stats.spectral.attach_spectral_indices--returns">Returns:<a class="headerlink" href="#nickyspatial.stats.spectral.attach_spectral_indices--returns" title="Permanent link">&para;</a></h4>
<p>indices : dict
    Dictionary with calculated indices</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/stats/spectral.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="k">def</span><span class="w"> </span><span class="nf">attach_spectral_indices</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate multiple spectral indices for objects in a layer.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        Layer to calculate indices for</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    bands : dict, optional</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        Dictionary mapping band names to column names</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    --------</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    indices : dict</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        Dictionary with calculated indices</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="n">bands</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>            <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="s2">&quot;Blue_mean&quot;</span><span class="p">,</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>            <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="s2">&quot;Green_mean&quot;</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;Red_mean&quot;</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>            <span class="s2">&quot;nir&quot;</span><span class="p">:</span> <span class="s2">&quot;NIR_mean&quot;</span><span class="p">,</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="p">}</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="k">for</span> <span class="n">_band_name</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">bands</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Band column &#39;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&#39; not found. Some indices may not be calculated.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="n">indices</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="c1"># NDVI (Normalized Difference Vegetation Index)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">if</span> <span class="s2">&quot;nir&quot;</span> <span class="ow">in</span> <span class="n">bands</span> <span class="ow">and</span> <span class="s2">&quot;red&quot;</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">:</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">if</span> <span class="n">bands</span><span class="p">[</span><span class="s2">&quot;nir&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">bands</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="n">ndvi</span> <span class="o">=</span> <span class="n">attach_ndvi</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">bands</span><span class="p">[</span><span class="s2">&quot;nir&quot;</span><span class="p">],</span> <span class="n">bands</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">],</span> <span class="s2">&quot;NDVI&quot;</span><span class="p">)</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="n">indices</span><span class="p">[</span><span class="s2">&quot;NDVI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ndvi</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="c1"># NDWI (Normalized Difference Water Index)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">if</span> <span class="s2">&quot;green&quot;</span> <span class="ow">in</span> <span class="n">bands</span> <span class="ow">and</span> <span class="s2">&quot;nir&quot;</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="k">if</span> <span class="n">bands</span><span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">bands</span><span class="p">[</span><span class="s2">&quot;nir&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">green</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">bands</span><span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">]]</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">nir</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">bands</span><span class="p">[</span><span class="s2">&quot;nir&quot;</span><span class="p">]]</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="n">denominator</span> <span class="o">=</span> <span class="n">green</span> <span class="o">+</span> <span class="n">nir</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">denominator</span> <span class="o">!=</span> <span class="mi">0</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="n">ndwi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">))</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">ndwi</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">green</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">nir</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;NDWI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ndwi</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="n">indices</span><span class="p">[</span><span class="s2">&quot;NDWI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>                <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">ndwi</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>                <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">ndwi</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>                <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">ndwi</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>                <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ndwi</span><span class="p">),</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="p">}</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="k">return</span> <span class="n">indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="nickyspatialutils"><code>nickyspatial.utils</code><a class="headerlink" href="#nickyspatialutils" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<a id="nickyspatial.utils"></a>
    <div class="doc doc-contents first">

        <p>This modules contains utility functions for handling attributes, geometries, and coordinate reference systems.</p>









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="nickyspatial.utils.helpers"></a>
    <div class="doc doc-contents first">

        <p>Helpers , Aren't they useful ?</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="nickyspatial.utils.helpers.calculate_statistics_summary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_statistics_summary</span><span class="p">(</span><span class="n">layer_manager</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.utils.helpers.calculate_statistics_summary" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate summary statistics for all layers in a layer manager.</p>
<h4 id="nickyspatial.utils.helpers.calculate_statistics_summary--parameters">Parameters:<a class="headerlink" href="#nickyspatial.utils.helpers.calculate_statistics_summary--parameters" title="Permanent link">&para;</a></h4>
<p>layer_manager : LayerManager
    Layer manager containing layers
output_file : str, optional
    Path to save the summary to (as JSON)</p>
<h4 id="nickyspatial.utils.helpers.calculate_statistics_summary--returns">Returns:<a class="headerlink" href="#nickyspatial.utils.helpers.calculate_statistics_summary--returns" title="Permanent link">&para;</a></h4>
<p>summary : dict
    Dictionary with summary statistics</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/utils/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_statistics_summary</span><span class="p">(</span><span class="n">layer_manager</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate summary statistics for all layers in a layer manager.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    layer_manager : LayerManager</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        Layer manager containing layers</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    output_file : str, optional</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        Path to save the summary to (as JSON)</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    --------</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    summary : dict</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        Dictionary with summary statistics</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="n">summary</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="k">for</span> <span class="n">layer_name</span> <span class="ow">in</span> <span class="n">layer_manager</span><span class="o">.</span><span class="n">get_layer_names</span><span class="p">():</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="n">layer</span> <span class="o">=</span> <span class="n">layer_manager</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="n">layer_name</span><span class="p">)</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="n">layer_summary</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>            <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">created_at</span><span class="p">),</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>            <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="n">layer</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">parent</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="p">}</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="n">layer_summary</span><span class="p">[</span><span class="s2">&quot;object_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>            <span class="k">if</span> <span class="s2">&quot;area_units&quot;</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>                <span class="n">layer_summary</span><span class="p">[</span><span class="s2">&quot;total_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;area_units&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>                <span class="n">layer_summary</span><span class="p">[</span><span class="s2">&quot;mean_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;area_units&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>                    <span class="n">class_counts</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>                    <span class="n">layer_summary</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">_counts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">class_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">attached_functions</span><span class="p">:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>            <span class="n">layer_summary</span><span class="p">[</span><span class="s2">&quot;functions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">attached_functions</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">summary</span><span class="p">[</span><span class="n">layer_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_summary</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_file</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="k">return</span> <span class="n">summary</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.utils.helpers.create_sample_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_sample_data</span><span class="p">()</span></code>

<a href="#nickyspatial.utils.helpers.create_sample_data" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create a synthetic 4-band (B, G, R, NIR) image for testing.</p>
<h4 id="nickyspatial.utils.helpers.create_sample_data--returns">Returns:<a class="headerlink" href="#nickyspatial.utils.helpers.create_sample_data--returns" title="Permanent link">&para;</a></h4>
<p>image_data : numpy.ndarray
    Synthetic image data
transform : affine.Affine
    Affine transformation for the raster
crs : rasterio.crs.CRS
    Coordinate reference system</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/utils/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_sample_data</span><span class="p">():</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a synthetic 4-band (B, G, R, NIR) image for testing.</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    --------</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    image_data : numpy.ndarray</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        Synthetic image data</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    transform : affine.Affine</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        Affine transformation for the raster</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    crs : rasterio.crs.CRS</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">        Coordinate reference system</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="c1">## need to write logic for this one to create a pseduo image</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="c1"># return image_data, transform, crs</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.utils.helpers.get_band_statistics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_band_statistics</span><span class="p">(</span><span class="n">image_data</span><span class="p">,</span> <span class="n">band_names</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.utils.helpers.get_band_statistics" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate statistics for each band in a raster image.</p>
<h4 id="nickyspatial.utils.helpers.get_band_statistics--parameters">Parameters:<a class="headerlink" href="#nickyspatial.utils.helpers.get_band_statistics--parameters" title="Permanent link">&para;</a></h4>
<p>image_data : numpy.ndarray
    Raster image data (bands, height, width)
band_names : list of str, optional
    Names of the bands</p>
<h4 id="nickyspatial.utils.helpers.get_band_statistics--returns">Returns:<a class="headerlink" href="#nickyspatial.utils.helpers.get_band_statistics--returns" title="Permanent link">&para;</a></h4>
<p>stats : dict
    Dictionary with band statistics</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/utils/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_band_statistics</span><span class="p">(</span><span class="n">image_data</span><span class="p">,</span> <span class="n">band_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate statistics for each band in a raster image.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    image_data : numpy.ndarray</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        Raster image data (bands, height, width)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    band_names : list of str, optional</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        Names of the bands</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    --------</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    stats : dict</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        Dictionary with band statistics</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="n">num_bands</span> <span class="o">=</span> <span class="n">image_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="k">if</span> <span class="n">band_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">band_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Band_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bands</span><span class="p">)]</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">band_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">band_names</span><span class="p">):</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">num_bands</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="k">break</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">band_data</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">stats</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">band_data</span><span class="p">)),</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">band_data</span><span class="p">)),</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">band_data</span><span class="p">)),</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">band_data</span><span class="p">)),</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="s2">&quot;median&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">band_data</span><span class="p">)),</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="s2">&quot;percentile_5&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">band_data</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="s2">&quot;percentile_95&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">band_data</span><span class="p">,</span> <span class="mi">95</span><span class="p">)),</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="p">}</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="k">return</span> <span class="n">stats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.utils.helpers.memory_usage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">memory_usage</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span></code>

<a href="#nickyspatial.utils.helpers.memory_usage" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Estimate memory usage of a layer in MB.</p>
<h4 id="nickyspatial.utils.helpers.memory_usage--parameters">Parameters:<a class="headerlink" href="#nickyspatial.utils.helpers.memory_usage--parameters" title="Permanent link">&para;</a></h4>
<p>layer : Layer
    Layer to calculate memory usage for</p>
<h4 id="nickyspatial.utils.helpers.memory_usage--returns">Returns:<a class="headerlink" href="#nickyspatial.utils.helpers.memory_usage--returns" title="Permanent link">&para;</a></h4>
<p>memory_mb : float
    Estimated memory usage in MB</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/utils/helpers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="k">def</span><span class="w"> </span><span class="nf">memory_usage</span><span class="p">(</span><span class="n">layer</span><span class="p">):</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Estimate memory usage of a layer in MB.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        Layer to calculate memory usage for</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    --------</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    memory_mb : float</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        Estimated memory usage in MB</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="n">memory</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">memory</span> <span class="o">+=</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">nbytes</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                <span class="n">memory</span> <span class="o">+=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">memory</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="n">memory_mb</span> <span class="o">=</span> <span class="n">memory</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="k">return</span> <span class="n">memory_mb</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="nickyspatialviz"><code>nickyspatial.viz</code><a class="headerlink" href="#nickyspatialviz" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<a id="nickyspatial.viz"></a>
    <div class="doc doc-contents first">

        <p>Alrighty , let's get this visualization party started!</p>
<p>No matter what you do you need to see it and present it , this is the module for it
to contain all code about visualizaing the layers , object rule results etc.</p>









  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="nickyspatial.viz.charts"></a>
    <div class="doc doc-contents first">

        <p>Visualization functions for plotting histograms, statistics, and scatter plots.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="nickyspatial.viz.charts.plot_histogram" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_histogram</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">by_class</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.viz.charts.plot_histogram" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Plot a histogram of attribute values.</p>
<h4 id="nickyspatial.viz.charts.plot_histogram--parameters">Parameters:<a class="headerlink" href="#nickyspatial.viz.charts.plot_histogram--parameters" title="Permanent link">&para;</a></h4>
<p>layer : Layer
    Layer containing data
attribute : str
    Attribute to plot
bins : int
    Number of bins
figsize : tuple
    Figure size
by_class : str, optional
    Column to group by (e.g., 'classification')</p>
<h4 id="nickyspatial.viz.charts.plot_histogram--returns">Returns:<a class="headerlink" href="#nickyspatial.viz.charts.plot_histogram--returns" title="Permanent link">&para;</a></h4>
<p>fig : matplotlib.figure.Figure
    Figure object</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/viz/charts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_histogram</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">by_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot a histogram of attribute values.</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">        Layer containing data</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    attribute : str</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">        Attribute to plot</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    bins : int</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">        Number of bins</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    figsize : tuple</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">        Figure size</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    by_class : str, optional</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        Column to group by (e.g., &#39;classification&#39;)</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    --------</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    fig : matplotlib.figure.Figure</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        Figure object</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">attribute</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attribute &#39;</span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2">&#39; not found in layer objects&quot;</span><span class="p">)</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="k">if</span> <span class="n">by_class</span> <span class="ow">and</span> <span class="n">by_class</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[[</span><span class="n">attribute</span><span class="p">,</span> <span class="n">by_class</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="k">for</span> <span class="n">class_value</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by_class</span><span class="p">):</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>            <span class="k">if</span> <span class="n">class_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>                <span class="k">continue</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>            <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="n">attribute</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">class_value</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">by_class</span><span class="p">)</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">attribute</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Histogram of </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.viz.charts.plot_scatter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_scatter</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">x_attribute</span><span class="p">,</span> <span class="n">y_attribute</span><span class="p">,</span> <span class="n">color_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span></code>

<a href="#nickyspatial.viz.charts.plot_scatter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create a scatter plot of two attributes.</p>
<h4 id="nickyspatial.viz.charts.plot_scatter--parameters">Parameters:<a class="headerlink" href="#nickyspatial.viz.charts.plot_scatter--parameters" title="Permanent link">&para;</a></h4>
<p>layer : Layer
    Layer containing data
x_attribute : str
    Attribute for x-axis
y_attribute : str
    Attribute for y-axis
color_by : str, optional
    Attribute to color points by
figsize : tuple
    Figure size</p>
<h4 id="nickyspatial.viz.charts.plot_scatter--returns">Returns:<a class="headerlink" href="#nickyspatial.viz.charts.plot_scatter--returns" title="Permanent link">&para;</a></h4>
<p>fig : matplotlib.figure.Figure
    Figure object</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/viz/charts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_scatter</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">x_attribute</span><span class="p">,</span> <span class="n">y_attribute</span><span class="p">,</span> <span class="n">color_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)):</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a scatter plot of two attributes.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        Layer containing data</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    x_attribute : str</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        Attribute for x-axis</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    y_attribute : str</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        Attribute for y-axis</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">    color_by : str, optional</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        Attribute to color points by</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    figsize : tuple</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        Figure size</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">    --------</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">    fig : matplotlib.figure.Figure</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        Figure object</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">x_attribute</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="n">y_attribute</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Attributes not found in layer objects&quot;</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="k">if</span> <span class="n">color_by</span> <span class="ow">and</span> <span class="n">color_by</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">x_attribute</span><span class="p">],</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">y_attribute</span><span class="p">],</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="n">c</span><span class="o">=</span><span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">color_by</span><span class="p">],</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="p">)</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scatter</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">color_by</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">x_attribute</span><span class="p">],</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">y_attribute</span><span class="p">],</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">y_attribute</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">x_attribute</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_attribute</span><span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_attribute</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.viz.charts.plot_statistics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_statistics</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">stats_dict</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">y_log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#nickyspatial.viz.charts.plot_statistics" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Plot statistics from a statistics dictionary.</p>
<h4 id="nickyspatial.viz.charts.plot_statistics--parameters">Parameters:<a class="headerlink" href="#nickyspatial.viz.charts.plot_statistics--parameters" title="Permanent link">&para;</a></h4>
<p>layer : Layer
    Layer the statistics are calculated for
stats_dict : dict
    Dictionary with statistics (from attach_* functions)
figsize : tuple
    Figure size
kind : str
    Plot type: 'bar', 'line', or 'pie'
y_log : bool
    Whether to use logarithmic scale for y-axis</p>
<h4 id="nickyspatial.viz.charts.plot_statistics--returns">Returns:<a class="headerlink" href="#nickyspatial.viz.charts.plot_statistics--returns" title="Permanent link">&para;</a></h4>
<p>fig : matplotlib.figure.Figure
    Figure object</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/viz/charts.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_statistics</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">stats_dict</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">y_log</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot statistics from a statistics dictionary.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    -----------</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    layer : Layer</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        Layer the statistics are calculated for</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    stats_dict : dict</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        Dictionary with statistics (from attach_* functions)</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    figsize : tuple</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        Figure size</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    kind : str</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        Plot type: &#39;bar&#39;, &#39;line&#39;, or &#39;pie&#39;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    y_log : bool</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        Whether to use logarithmic scale for y-axis</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    --------</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    fig : matplotlib.figure.Figure</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        Figure object</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">flat_stats</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_flatten_dict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>                <span class="n">_flatten_dict</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">key</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>                <span class="n">flat_stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="n">_flatten_dict</span><span class="p">(</span><span class="n">stats_dict</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;pie&quot;</span> <span class="ow">and</span> <span class="s2">&quot;class_percentages&quot;</span> <span class="ow">in</span> <span class="n">stats_dict</span><span class="p">:</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="n">percentages</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="s2">&quot;class_percentages&quot;</span><span class="p">]</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">percentages</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">percentages</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">autopct</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.1f%%</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Class Distribution&quot;</span><span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;pie&quot;</span> <span class="ow">and</span> <span class="s2">&quot;percentages&quot;</span> <span class="ow">in</span> <span class="n">flat_stats</span><span class="p">:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="n">percentages</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">flat_stats</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;percentage&quot;</span><span class="p">)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">values</span> <span class="o">=</span> <span class="n">percentages</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_percentage&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">percentages</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">autopct</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.1f%%</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Distribution&quot;</span><span class="p">)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">stats_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Metric&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">flat_stats</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">flat_stats</span><span class="o">.</span><span class="n">values</span><span class="p">())})</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="k">if</span> <span class="n">kind</span> <span class="o">!=</span> <span class="s2">&quot;line&quot;</span><span class="p">:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="n">stats_df</span> <span class="o">=</span> <span class="n">stats_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;bar&quot;</span><span class="p">:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Metric&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">stats_df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;line&quot;</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Metric&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">stats_df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="k">if</span> <span class="n">y_log</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Statistics Summary&quot;</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="nickyspatial.viz.maps"></a>
    <div class="doc doc-contents first">

        <p>Functions to create maps and visualize layers.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="nickyspatial.viz.maps.plot_classification" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_classification</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">class_field</span><span class="o">=</span><span class="s1">&#39;classification&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">class_color</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.viz.maps.plot_classification" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Plot classified segments with different colors for each class.</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/viz/maps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_classification</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">class_field</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">class_color</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot classified segments with different colors for each class.&quot;&quot;&quot;</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">class_color</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="n">class_color</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="k">if</span> <span class="n">class_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Class field &#39;</span><span class="si">{</span><span class="n">class_field</span><span class="si">}</span><span class="s2">&#39; not found in layer objects&quot;</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="n">class_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">class_field</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="c1"># generate base colormap</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="n">base_colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">class_values</span><span class="p">),</span> <span class="mi">1</span><span class="p">)))</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>    <span class="n">colors_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">class_value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">class_values</span><span class="p">):</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="k">if</span> <span class="n">class_color</span> <span class="ow">and</span> <span class="n">class_value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">class_color</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="c1"># reuse stored color</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="n">color_hex</span> <span class="o">=</span> <span class="n">class_color</span><span class="p">[</span><span class="n">class_value</span><span class="p">]</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="c1"># assign new color (from tab20 or random if exceeds)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_colors</span><span class="p">):</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>                <span class="n">rgb</span> <span class="o">=</span> <span class="n">base_colors</span><span class="p">[</span><span class="n">idx</span><span class="p">][:</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>                <span class="n">color_hex</span> <span class="o">=</span> <span class="s2">&quot;#</span><span class="si">{:02x}{:02x}{:02x}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">))</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>                <span class="n">color_hex</span> <span class="o">=</span> <span class="s2">&quot;#</span><span class="si">{:06x}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0xFFFFFF</span><span class="p">))</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="n">class_color</span><span class="p">[</span><span class="n">class_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">color_hex</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="c1"># convert hex → RGB tuple for ListedColormap</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="n">rgb_tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">color_hex</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="n">colors_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgb_tuple</span><span class="p">)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="c1"># create colormap</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="n">cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors_list</span><span class="p">)</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="c1"># map class values to indices</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="n">class_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">value</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">class_values</span><span class="p">)}</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;_class_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">class_field</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">class_map</span><span class="p">)</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="n">column</span><span class="o">=</span><span class="s2">&quot;_class_id&quot;</span><span class="p">,</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="p">)</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="k">if</span> <span class="n">legend</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="n">patches</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">class_color</span><span class="p">[</span><span class="n">value</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">class_values</span><span class="p">]</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">patches</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">class_field</span><span class="p">)</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="c1"># ax.set_title(f&quot;Classification by {class_field}&quot;)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Classification Map&quot;</span><span class="p">)</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X Coordinate&quot;</span><span class="p">)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y Coordinate&quot;</span><span class="p">)</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="c1"># cleanup temporary column</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="k">if</span> <span class="s2">&quot;_class_id&quot;</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_class_id&quot;</span><span class="p">])</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.viz.maps.plot_comparison" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_comparison</span><span class="p">(</span><span class="n">before_layer</span><span class="p">,</span> <span class="n">after_layer</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nickyspatial.viz.maps.plot_comparison" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Plot before and after views of layers for comparison.</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/viz/maps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_comparison</span><span class="p">(</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="n">before_layer</span><span class="p">,</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="n">after_layer</span><span class="p">,</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="n">attribute</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="n">class_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="p">):</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot before and after views of layers for comparison.&quot;&quot;&quot;</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="k">if</span> <span class="n">attribute</span> <span class="ow">and</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">before_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="n">before_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">attribute</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Before: </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="k">elif</span> <span class="n">class_field</span> <span class="ow">and</span> <span class="n">class_field</span> <span class="ow">in</span> <span class="n">before_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="n">class_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">before_layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">class_field</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="n">num_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_values</span><span class="p">)</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="n">cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="n">class_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">value</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">class_values</span><span class="p">)}</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="n">before_layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;_class_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">before_layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">class_field</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">class_map</span><span class="p">)</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="n">before_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;_class_id&quot;</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>            <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="p">)</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="n">patches</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">class_values</span><span class="p">)]</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">patches</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">class_field</span><span class="p">)</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Before: </span><span class="si">{</span><span class="n">class_field</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="n">before_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Before&quot;</span><span class="p">)</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>    <span class="k">if</span> <span class="n">attribute</span> <span class="ow">and</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">after_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="n">after_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">attribute</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After: </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="k">elif</span> <span class="n">class_field</span> <span class="ow">and</span> <span class="n">class_field</span> <span class="ow">in</span> <span class="n">after_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="n">class_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">after_layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">class_field</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="n">num_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_values</span><span class="p">)</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="n">cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="n">class_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">value</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">class_values</span><span class="p">)}</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>        <span class="n">after_layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;_class_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">after_layer</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">class_field</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">class_map</span><span class="p">)</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="n">after_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;_class_id&quot;</span><span class="p">,</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>            <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>            <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="p">)</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="n">patches</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">class_values</span><span class="p">)]</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">patches</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">class_field</span><span class="p">)</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After: </span><span class="si">{</span><span class="n">class_field</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="n">after_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;After&quot;</span><span class="p">)</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>    <span class="k">if</span> <span class="s2">&quot;_class_id&quot;</span> <span class="ow">in</span> <span class="n">before_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="n">before_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">before_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_class_id&quot;</span><span class="p">])</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>    <span class="k">if</span> <span class="s2">&quot;_class_id&quot;</span> <span class="ow">in</span> <span class="n">after_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="n">after_layer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">after_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_class_id&quot;</span><span class="p">])</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.viz.maps.plot_layer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_layer</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">image_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rgb_bands</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">show_boundaries</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#nickyspatial.viz.maps.plot_layer" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Plot a layer, optionally with an attribute or image backdrop.</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/viz/maps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_layer</span><span class="p">(</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="n">layer</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="n">image_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="n">attribute</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">rgb_bands</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">show_boundaries</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="p">):</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot a layer, optionally with an attribute or image backdrop.&quot;&quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="k">elif</span> <span class="n">attribute</span><span class="p">:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> by Segment&quot;</span><span class="p">)</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Layer Visualization&quot;</span><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="k">if</span> <span class="n">image_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="n">num_bands</span> <span class="o">=</span> <span class="n">image_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="k">if</span> <span class="n">num_bands</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">max</span><span class="p">(</span><span class="n">rgb_bands</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_bands</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>            <span class="n">r</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="n">rgb_bands</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>            <span class="n">g</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="n">rgb_bands</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>            <span class="n">b</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="n">rgb_bands</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>            <span class="n">r_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="n">g_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">g</span> <span class="o">-</span> <span class="n">g</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">g</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="n">b_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">b</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>            <span class="n">rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">r_norm</span><span class="p">,</span> <span class="n">g_norm</span><span class="p">,</span> <span class="n">b_norm</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rgb</span><span class="p">)</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>            <span class="n">gray</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="n">gray_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">gray</span> <span class="o">-</span> <span class="n">gray</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">gray</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">gray</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gray_norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="k">if</span> <span class="n">attribute</span> <span class="ow">and</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>            <span class="n">column</span><span class="o">=</span><span class="n">attribute</span><span class="p">,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span> <span class="k">if</span> <span class="n">image_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">if</span> <span class="n">show_boundaries</span> <span class="ow">and</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">skimage.segmentation</span><span class="w"> </span><span class="kn">import</span> <span class="n">mark_boundaries</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="k">if</span> <span class="n">image_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>            <span class="k">if</span> <span class="s2">&quot;num_bands&quot;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="ow">and</span> <span class="n">num_bands</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                <span class="n">base_img</span> <span class="o">=</span> <span class="n">rgb</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                <span class="n">gray</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>                <span class="n">gray_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">gray</span> <span class="o">-</span> <span class="n">gray</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">gray</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">gray</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>                <span class="n">base_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">gray_norm</span><span class="p">,</span> <span class="n">gray_norm</span><span class="p">,</span> <span class="n">gray_norm</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>            <span class="n">bounded</span> <span class="o">=</span> <span class="n">mark_boundaries</span><span class="p">(</span><span class="n">base_img</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;thick&quot;</span><span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="k">if</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">bounded</span><span class="p">)</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>                <span class="n">mark_boundaries</span><span class="p">(</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">)),</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>                    <span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>                    <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;thick&quot;</span><span class="p">,</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>                <span class="p">)</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="p">)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.viz.maps.plot_layer_interactive" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_layer_interactive</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">image_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span></code>

<a href="#nickyspatial.viz.maps.plot_layer_interactive" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Interactive plot of a layer with widgets and working click.</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/viz/maps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_layer_interactive</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">image_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)):</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Interactive plot of a layer with widgets and working click.&quot;&quot;&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    %matplotlib widget</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    plot_layer_interactive(layer=segmentation_layer,image_data=image_data,figsize=(10,8))</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    Not supported in google collab</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="c1"># attribute_options = [None] + list(layer.objects.columns)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="c1"># attribute_widget = widgets.Dropdown(</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="c1">#     options=attribute_options,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="c1">#     value=None,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="c1">#     description=&#39;Attribute:&#39;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="c1"># )</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="n">title_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;Layer Visualization&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Title:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="c1"># cmap_widget = widgets.Dropdown(</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="c1">#     options=plt.colormaps(),</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="c1">#     value=&#39;viridis&#39;,</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="c1">#     description=&#39;Colormap:&#39;</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="c1"># )</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">rgb_band_max</span> <span class="o">=</span> <span class="n">image_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">image_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">2</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="c1"># # Ensure that the default value is within the valid range</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="c1"># default_value = (2, 1, 0) if rgb_band_max &gt;= 2 else (0,)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="c1"># # Create the widget with the correct range and default value</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="c1"># red_band_widget = widgets.Select(</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="c1">#     options=list(range(rgb_band_max + 1)),  # This ensures valid options based on the shape of the image</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="c1">#     value=default_value[:rgb_band_max + 1],  # This makes sure the default value matches the options available</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="c1">#     description=&#39;Red Band:&#39;</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="c1"># )</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="c1"># rgb_band_max = image_data.shape[0] - 1 if image_data is not None else 2</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">red_band_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">options</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">rgb_band_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">rgb_band_max</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Red Band:&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="p">)</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="n">green_band_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="n">options</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">rgb_band_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span> <span class="k">if</span> <span class="n">rgb_band_max</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Green Band:&quot;</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="n">blue_band_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">options</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">rgb_band_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span> <span class="k">if</span> <span class="n">rgb_band_max</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Blue Band:&quot;</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">show_boundaries_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Show Boundaries&quot;</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="c1"># Create a figure and output widget</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="n">out_fig</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="c1"># with out_fig:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="c1">#     display(fig)</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">onclick</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="k">return</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="n">x_pix</span><span class="p">,</span> <span class="n">y_pix</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">x_pix</span> <span class="o">&lt;</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">y_pix</span> <span class="o">&lt;</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="n">segment_id</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="p">[</span><span class="n">y_pix</span><span class="p">,</span> <span class="n">x_pix</span><span class="p">]</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Clicked at (x=</span><span class="si">{</span><span class="n">x_pix</span><span class="si">}</span><span class="s2">, y=</span><span class="si">{</span><span class="n">y_pix</span><span class="si">}</span><span class="s2">) → Segment ID: </span><span class="si">{</span><span class="n">segment_id</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="n">title_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">msg</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Clicked outside raster bounds&quot;</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="n">title_widget</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">msg</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s2">&quot;button_press_event&quot;</span><span class="p">,</span> <span class="n">onclick</span><span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_plot</span><span class="p">(</span><span class="n">red_band</span><span class="p">,</span> <span class="n">green_band</span><span class="p">,</span> <span class="n">blue_band</span><span class="p">,</span> <span class="n">show_boundaries</span><span class="p">):</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="c1"># def update_plot(attribute, title, cmap, rgb_bands, show_boundaries):</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="c1"># ax.set_title(title)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="k">if</span> <span class="n">image_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="n">num_bands</span> <span class="o">=</span> <span class="n">image_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="k">if</span> <span class="n">red_band</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">green_band</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">blue_band</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                <span class="n">r</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="n">red_band</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                <span class="n">g</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="n">green_band</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="n">blue_band</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>                <span class="n">r_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                <span class="n">g_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">g</span> <span class="o">-</span> <span class="n">g</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">g</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                <span class="n">b_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">b</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                <span class="n">rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">r_norm</span><span class="p">,</span> <span class="n">g_norm</span><span class="p">,</span> <span class="n">b_norm</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rgb</span><span class="p">)</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                <span class="n">gray</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>                <span class="n">gray_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">gray</span> <span class="o">-</span> <span class="n">gray</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">gray</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">gray</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gray_norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="c1"># if attribute and attribute in layer.objects.columns:</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="c1">#     layer.objects.plot(</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="c1">#         column=attribute,</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="c1">#         cmap=cmap,</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="c1">#         ax=ax,</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="c1">#         legend=True,</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="c1">#         alpha=0.7 if image_data is not None else 1.0,</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="c1">#     )</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="k">if</span> <span class="n">show_boundaries</span> <span class="ow">and</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># show_boundaries and</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="k">if</span> <span class="n">image_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>                <span class="k">if</span> <span class="n">num_bands</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># and len(rgb_bands) &gt;= 3:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                    <span class="n">base_img</span> <span class="o">=</span> <span class="n">rgb</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                    <span class="n">gray</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                    <span class="n">gray_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">gray</span> <span class="o">-</span> <span class="n">gray</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">gray</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">gray</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                    <span class="n">base_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">gray_norm</span><span class="p">,</span> <span class="n">gray_norm</span><span class="p">,</span> <span class="n">gray_norm</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                <span class="n">bounded</span> <span class="o">=</span> <span class="n">mark_boundaries</span><span class="p">(</span><span class="n">base_img</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;thick&quot;</span><span class="p">)</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                <span class="c1"># if attribute is None:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">bounded</span><span class="p">)</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                    <span class="n">mark_boundaries</span><span class="p">(</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">)),</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>                        <span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>                        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;thick&quot;</span><span class="p">,</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>                    <span class="p">)</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                <span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="c1"># Zoom control widgets (manual)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="c1"># zoom_in_button = widgets.Button(description=&quot;Zoom In&quot;)</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="c1"># zoom_out_button = widgets.Button(description=&quot;Zoom Out&quot;)</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="c1"># def zoom_in(change):</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="c1">#     xlim, ylim = ax.get_xlim(), ax.get_ylim()</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="c1">#     ax.set_xlim(xlim[0] * 0.9, xlim[1] * 0.9)</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="c1">#     ax.set_ylim(ylim[0] * 0.9, ylim[1] * 0.9)</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="c1">#     fig.canvas.draw_idle()</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="c1"># def zoom_out(change):</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="c1">#     xlim, ylim = ax.get_xlim(), ax.get_ylim()</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="c1">#     ax.set_xlim(xlim[0] * 1.1, xlim[1] * 1.1)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="c1">#     ax.set_ylim(ylim[0] * 1.1, ylim[1] * 1.1)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="c1">#     fig.canvas.draw_idle()</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="c1"># zoom_in_button.on_click(zoom_in)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="c1"># zoom_out_button.on_click(zoom_out)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="n">ui</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="p">[</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="c1"># attribute_widget,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="c1"># title_widget,</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="c1"># cmap_widget,</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="n">red_band_widget</span><span class="p">,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="n">green_band_widget</span><span class="p">,</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="n">blue_band_widget</span><span class="p">,</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="n">show_boundaries_widget</span><span class="p">,</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="c1"># zoom_in_button,</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="c1"># zoom_out_button,</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="p">]</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="n">controls</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interactive_output</span><span class="p">(</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="n">update_plot</span><span class="p">,</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="p">{</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="c1"># &#39;attribute&#39;: attribute_widget,</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="c1"># &#39;title&#39;: title_widget,</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="c1"># &#39;cmap&#39;: cmap_widget,</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="s2">&quot;red_band&quot;</span><span class="p">:</span> <span class="n">red_band_widget</span><span class="p">,</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="s2">&quot;green_band&quot;</span><span class="p">:</span> <span class="n">green_band_widget</span><span class="p">,</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="s2">&quot;blue_band&quot;</span><span class="p">:</span> <span class="n">blue_band_widget</span><span class="p">,</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="s2">&quot;show_boundaries&quot;</span><span class="p">:</span> <span class="n">show_boundaries_widget</span><span class="p">,</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="p">},</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="p">)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="n">display</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span> <span class="n">out_fig</span><span class="p">,</span> <span class="n">controls</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.viz.maps.plot_layer_interactive_plotly" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_layer_interactive_plotly</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">image_data</span><span class="p">,</span> <span class="n">rgb_bands</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">show_boundaries</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span></code>

<a href="#nickyspatial.viz.maps.plot_layer_interactive_plotly" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Display an interactive RGB image with segment boundaries and hoverable segment IDs using Plotly.</p>
<p>Run in google collab as well.</p>
<h4 id="nickyspatial.viz.maps.plot_layer_interactive_plotly--parameters">Parameters:<a class="headerlink" href="#nickyspatial.viz.maps.plot_layer_interactive_plotly--parameters" title="Permanent link">&para;</a></h4>
<p>layer : object
    An object with a <code>.raster</code> attribute representing the labeled segmentation layer
    (e.g., output from a segmentation algorithm, such as SLIC).
image_data : image data to be visualized.
rgb_bands : tuple of int, optional
    Tuple of three integers specifying which bands to use for the RGB composite (default is (0, 1, 2)).
show_boundaries : bool, optional
    Whether to overlay the segment boundaries on the RGB image (default is True).
figsize : tuple of int, optional
    Tuple specifying the width and height of the interactive Plotly figure in pixels (default is (800, 400)).</p>
<h4 id="nickyspatial.viz.maps.plot_layer_interactive_plotly--returns">Returns:<a class="headerlink" href="#nickyspatial.viz.maps.plot_layer_interactive_plotly--returns" title="Permanent link">&para;</a></h4>
<p>None
    The function displays the interactive plot directly in the output cell in a Jupyter Notebook.</p>
<h4 id="nickyspatial.viz.maps.plot_layer_interactive_plotly--notes">Notes:<a class="headerlink" href="#nickyspatial.viz.maps.plot_layer_interactive_plotly--notes" title="Permanent link">&para;</a></h4>
<ul>
<li>Segment boundaries are drawn using <code>skimage.segmentation.mark_boundaries</code>.</li>
<li>Hovering over the image displays the segment ID from <code>layer.raster</code>.</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/viz/maps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_layer_interactive_plotly</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">image_data</span><span class="p">,</span> <span class="n">rgb_bands</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">show_boundaries</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">400</span><span class="p">)):</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Display an interactive RGB image with segment boundaries and hoverable segment IDs using Plotly.</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">    Run in google collab as well.</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">    layer : object</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">        An object with a `.raster` attribute representing the labeled segmentation layer</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a><span class="sd">        (e.g., output from a segmentation algorithm, such as SLIC).</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">    image_data : image data to be visualized.</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="sd">    rgb_bands : tuple of int, optional</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="sd">        Tuple of three integers specifying which bands to use for the RGB composite (default is (0, 1, 2)).</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="sd">    show_boundaries : bool, optional</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">        Whether to overlay the segment boundaries on the RGB image (default is True).</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">    figsize : tuple of int, optional</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">        Tuple specifying the width and height of the interactive Plotly figure in pixels (default is (800, 400)).</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="sd">    -------</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">    None</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="sd">        The function displays the interactive plot directly in the output cell in a Jupyter Notebook.</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">    Notes:</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">    -----</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">    - Segment boundaries are drawn using `skimage.segmentation.mark_boundaries`.</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">    - Hovering over the image displays the segment ID from `layer.raster`.</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_rgb_image</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>        <span class="n">r_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>        <span class="n">g_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">g</span> <span class="o">-</span> <span class="n">g</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">g</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>        <span class="n">b_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">b</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">r_norm</span><span class="p">,</span> <span class="n">g_norm</span><span class="p">,</span> <span class="n">b_norm</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_plot</span><span class="p">(</span><span class="n">rgb_bands</span><span class="p">,</span> <span class="n">show_boundaries</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>        <span class="n">rgb_image</span> <span class="o">=</span> <span class="n">get_rgb_image</span><span class="p">(</span><span class="n">image_data</span><span class="p">[</span><span class="n">rgb_bands</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">image_data</span><span class="p">[</span><span class="n">rgb_bands</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">image_data</span><span class="p">[</span><span class="n">rgb_bands</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>        <span class="k">if</span> <span class="n">show_boundaries</span><span class="p">:</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>            <span class="n">rgb_image</span> <span class="o">=</span> <span class="n">mark_boundaries</span><span class="p">(</span><span class="n">rgb_image</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;thick&quot;</span><span class="p">)</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="n">rgb_image</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)))</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>        <span class="c1"># Add segment ID overlay with hover</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>            <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>                <span class="n">z</span><span class="o">=</span><span class="n">layer</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>                <span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>                <span class="n">hoverinfo</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">,</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>                <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>                <span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;Segment ID: %</span><span class="si">{z}</span><span class="s2">&lt;extra&gt;&lt;/extra&gt;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>                <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>            <span class="p">)</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>        <span class="p">)</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Hover to see Segment ID&quot;</span><span class="p">,</span> <span class="n">dragmode</span><span class="o">=</span><span class="s2">&quot;pan&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>        <span class="p">)</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>    <span class="n">update_plot</span><span class="p">(</span><span class="n">rgb_bands</span><span class="o">=</span><span class="n">rgb_bands</span><span class="p">,</span> <span class="n">show_boundaries</span><span class="o">=</span><span class="n">show_boundaries</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nickyspatial.viz.maps.plot_sample" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_sample</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">image_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rgb_bands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_field</span><span class="o">=</span><span class="s1">&#39;classification&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">class_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#nickyspatial.viz.maps.plot_sample" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Plot classified segments on top of RGB or grayscale image data.</p>
<p>Parameters:
- layer: Layer object with .objects (GeoDataFrame)
- image_data: 3D numpy array (bands, height, width)
- transform: Affine transform for the image (needed to compute extent)
- red_band, green_band, blue_band: indices for RGB bands</p>


            <details class="quote">
              <summary>Source code in <code>nickyspatial/viz/maps.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_sample</span><span class="p">(</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="n">layer</span><span class="p">,</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="n">image_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>    <span class="n">rgb_bands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>    <span class="n">class_field</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>    <span class="n">class_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="p">):</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot classified segments on top of RGB or grayscale image data.</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">    - layer: Layer object with .objects (GeoDataFrame)</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">    - image_data: 3D numpy array (bands, height, width)</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">    - transform: Affine transform for the image (needed to compute extent)</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">    - red_band, green_band, blue_band: indices for RGB bands</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>    <span class="c1"># ---- Plot RGB or Grayscale image from array ----</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>    <span class="k">if</span> <span class="n">image_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="n">num_bands</span> <span class="o">=</span> <span class="n">image_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span class="k">if</span> <span class="n">rgb_bands</span> <span class="ow">and</span> <span class="n">num_bands</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>            <span class="n">r</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="n">rgb_bands</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="n">g</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="n">rgb_bands</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>            <span class="n">b</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="n">rgb_bands</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>            <span class="n">r_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>            <span class="n">g_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">g</span> <span class="o">-</span> <span class="n">g</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">g</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>            <span class="n">b_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">b</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>            <span class="n">rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">r_norm</span><span class="p">,</span> <span class="n">g_norm</span><span class="p">,</span> <span class="n">b_norm</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="k">if</span> <span class="n">transform</span><span class="p">:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>                <span class="kn">from</span><span class="w"> </span><span class="nn">rasterio.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">plotting_extent</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>                <span class="n">extent</span> <span class="o">=</span> <span class="n">plotting_extent</span><span class="p">(</span><span class="n">image_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rgb</span><span class="p">)</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="n">gray</span> <span class="o">=</span> <span class="n">image_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>            <span class="n">gray_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">gray</span> <span class="o">-</span> <span class="n">gray</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">gray</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">gray</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>            <span class="k">if</span> <span class="n">transform</span><span class="p">:</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>                <span class="kn">from</span><span class="w"> </span><span class="nn">rasterio.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">plotting_extent</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>                <span class="n">extent</span> <span class="o">=</span> <span class="n">plotting_extent</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gray_norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gray_norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>    <span class="c1"># ---- Plot classification overlay ----</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>    <span class="n">gdf</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>    <span class="k">if</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;GeoDataFrame has no CRS&quot;</span><span class="p">)</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">class_color</span><span class="p">:</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="n">class_color</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="k">if</span> <span class="n">class_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Class field &#39;</span><span class="si">{</span><span class="n">class_field</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="n">class_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">gdf</span><span class="p">[</span><span class="n">class_field</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="n">base_colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">class_values</span><span class="p">),</span> <span class="mi">1</span><span class="p">)))</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="n">class_map</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">class_value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">class_values</span><span class="p">):</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="k">if</span> <span class="n">class_value</span> <span class="ow">in</span> <span class="n">class_color</span><span class="p">:</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>            <span class="n">color_hex</span> <span class="o">=</span> <span class="n">class_color</span><span class="p">[</span><span class="n">class_value</span><span class="p">]</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>            <span class="n">rgb_val</span> <span class="o">=</span> <span class="n">base_colors</span><span class="p">[</span><span class="n">idx</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_colors</span><span class="p">)][:</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>            <span class="n">color_hex</span> <span class="o">=</span> <span class="s2">&quot;#</span><span class="si">{:02x}{:02x}{:02x}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rgb_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">rgb_val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">rgb_val</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span><span class="p">))</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>            <span class="n">class_color</span><span class="p">[</span><span class="n">class_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">color_hex</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="n">class_map</span><span class="p">[</span><span class="n">class_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">color_hex</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>    <span class="k">for</span> <span class="n">class_value</span> <span class="ow">in</span> <span class="n">class_values</span><span class="p">:</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="p">[</span><span class="n">class_field</span><span class="p">]</span> <span class="o">==</span> <span class="n">class_value</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">class_map</span><span class="p">[</span><span class="n">class_value</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="n">handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">class_map</span><span class="p">[</span><span class="n">val</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">class_values</span><span class="p">]</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">handles</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">class_field</span><span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Sample Data Visualization&quot;</span><span class="p">)</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="June 2, 2025 20:24:54">June 2, 2025</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="June 2, 2025 20:24:54">June 2, 2025</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight", "content.code.copy", "content.tabs.link"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>